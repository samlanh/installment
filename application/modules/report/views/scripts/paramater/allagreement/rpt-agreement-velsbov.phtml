<?php 
$tr = Application_Form_FrmLanguages::getCurrentlanguage();
$day = array(
		"Mon" =>'ច័ន្ទ',
		"Tue" =>'អង្គារ',
		"Wed" =>'ពុធ',
		"Thu" =>'ព្រហស្បតិ៍',
		"Fri" =>'សុក្រ',
		"Sat" =>'សៅរ៍',
		"Sun" =>'អាទិត្យ',
		);
	$month = array("01"=>"មករា","02"=>"កុម្ភៈ","03"=>"មីនា","04"=>"មេសា","05"=>"ឧសភា","06"=>"មិថុនា","07"=>"កក្កដា","08"=>"សីហា","09"=>"កញ្ញា","10"=>"តុលា","11"=>"វិច្ឆិកា","12"=>"ធ្នូ",);
	$key = new Application_Model_DbTable_DbKeycode();
	$dataterm = $key->getKeyCodeMiniInv(TRUE);
	
	$dbparmeter = new Report_Model_DbTable_DbParamater();
	$paid=0; if(!empty($this->sale_schedule)) foreach ($this->sale_schedule as $key=> $row){
	if($row['is_completed']==1 AND $this->agreement['is_reschedule']==3){
		continue;
	}
	$paid = $paid+$row['principal_permonth'];
}
?>
<script>
dojo.require("dijit.form.DateTextBox");
</script>
<script src="<?php echo $this->baseUrl();?>/js/pdbs_js.js"  type="text/javascript"></script>
<meta charset="utf-8">
<title><?php echo $tr->translate("AGREEMENT");?></title>
<style>
	#divPrint tr td h2,#divPrint p, #divPrint pre, #divPrint span, #divPrint li{ font-size: 20px !important; line-height:32px !important;}
	#divPrint #padding-left-p-2{
	 padding-left: 105px !important;	
	}
	
</style>
<div  id="exportword" style="min-height:22cm; margin:0 auto;padding:0px 0.5cm; width: 100%;">
<table style="font-family: 'Khmer OS Content'; width:100%;"  >
	<tr>
    	<td align="center">
    	 <div id="divPrint" >
    	 	<style>		
					    #divPrint #padding-left-p-2{
						 padding-left: 105px !important;	
						}
						#divPrint tr td h2, #divPrint p, #divPrint pre, #divPrint span{ font-size: 21px; line-height:32px;}
						#divPrint #padding-left{
							padding-left: 18px;
						}
						#divPrint #bold-padding-right{
							padding-right: 15px;
							font-family: khmer os battambang;
							font-size:21px;
						}
						#divPrint #padding-left-2{
							padding-left:15px;
						}
						
						#divPrint #padding-left-p-2{
						 margin-top:-1px; 
						 padding-left: 85px;	
						}
						#divPrint #padding-left-p{
					    padding-left: 105px;
						}
						span.padding-left {
						    padding-left: 70px;
						    display: inline-block;
						}
						#divPrint th{padding: 5px;}
						#divPrint span.value{ line-height:32px;display: inline-block; text-align: center;}
						
						body {
						    position: relative;
						}
						.value_label{
							    border-bottom: dotted 1px #000;
							}
						#divPrint ul, #divPrint ol{
							padding-left:18px;
							line-height: 29px;
						}
   				</style>
        	<table  style="font-family:'Times New Roman','Khmer OS Battambang'; width:100%; white-space:normal; padding:0;margin:0;border:0px; line-height: 42px; font-size: 21px;" >
        	<tr>
             	<td colspan="3" style="height: 30px">
             	&nbsp;
             	</td>
             </tr>
        	<tr>
                <td width="30%" valign="top"><img src="<?php echo $this->baseUrl();?>/images/logo.jpg" style="max-width:100%;max-height:100px;"></td>
                <td width="40%" align="center">
                <span style="text-align:center; line-height:36px; font-size:22px;font-family:'Khmer OS Muol Light';">ព្រះរាជាណាចក្រកម្ពុជា</span>
                <span style="text-align:center; line-height:36px; width: 100%; display: block; font-size:20px; font-family:'Khmer OS Muol Light'"><?php echo $tr->translate("ជាតិ សាសនា ព្រះមហាក្សត្រ");?></span>
                <span style="text-align:center; line-height:36px; width: 100%; display: block; font-size:20px; font-family: 'Tacteing';"><img src="<?php echo $this->baseUrl();?>/images/agreementsign.jpg" height="25px"></span>
                <td width="30%"></td>
             </tr> 
             <tr>
             	<td colspan="3">
             		<span style="margin-top:10px;text-align:center; line-height:26px; width: 100%; display: block; font-size:20px; font-family:'Khmer OS Muol Light'"><label>កិច្ចសន្យាលក់-ទិញ</label></span>
             	</td>
             </tr>
             <tr>
             	<td colspan="3" >
             			<br />
             			<ol style="list-style-type: cambodian;text-align:justify; margin-bottom: 20px;">
             				<li>
		             			លោក<span class="value" style="min-width:150px;font-weight: bolder;"><?php echo $this->agreement['project_manager_namekh'];?></span> ភេទ <span class="value" style="min-width:30px;"><?php echo $this->agreement['manager_sex'];?></span> 
		             			កាន់អត្តសញ្ញាណប័ណ្ណលេខ <span class="value" style="min-width:100px;"><?php echo $this->agreement['project_manager_nation_id'];?></span>
		             			<!-- អាយុ <span class="value" style="min-width:30px;"><?php //if (!empty($this->agreement['manager_dob']) && $this->agreement['manager_dob'] !='0000-00-00'){ echo date("Y") - date("Y",strtotime($this->agreement['manager_dob']));}?></span>ឆ្នាំ --> 
		             			 មានទីលំនៅបច្ចុប្ប​ន្ន  <!-- class="value" style="min-width:50px;" --><span ><?php echo $this->agreement['project_manager_p_current_address'];?> ។</span>
				             	បានយល់ព្រមព្រៀងគ្នាលក់ផ្ទះលេខ <span class="value" style="min-width:30px;"><?php echo $this->agreement['property_title'];?></span> ផ្លូវ <span class="value" style="min-width:40px;"><?php echo $this->agreement['property_street'];?></span> <!-- class="value" style="min-width:50px;" --> <span ><?php echo $this->agreement['project_location'];?></span>។<br />
			             			អោយទៅឈ្មោះ  <span class="value" style="min-width:100px;font-weight: bold;"><?php echo $this->agreement['client_namekh'];?></span> ភេទ <span class="value" style="min-width:30px;"><?php  if (!empty($this->agreement['sexKh']) ){ echo $this->agreement['sexKh'];}?></span>
			             			អាយុ  <span class="value" style="min-width:30px;"><?php if (!empty($this->agreement['dob']) && $this->agreement['dob'] !='0000-00-00'){ echo date("Y") - date("Y",strtotime($this->agreement['dob']));}?></span> ឆ្នាំ
			             			កាន់<?php echo $this->agreement['client_d_type'];?>លេខ <span class="value" style="min-width:100px;"><?php echo $this->agreement['client_nation_id'];?></span>
			             			 និងឈ្មោះ <span class="value" style="min-width:150px;font-weight:bold;"><?php echo $this->agreement['hname_kh'];?></span> ភេទ  <span class="value" style="min-width:40px;"><?php if (!empty($this->agreement['hname_kh']) ){  echo $this->agreement['client_buywith_sex'];}?></span> 
									 ត្រូវជា <span class="value" style="min-width:55px;"><?php echo $this->agreement['join_type'];?></span>
			             			អាយុ <span class="value" style="min-width:30px;"><?php if (!empty($this->agreement['w_client_dob_buywith']) && $this->agreement['w_client_dob_buywith'] !='0000-00-00'){ echo date("Y") - date("Y",strtotime($this->agreement['w_client_dob_buywith']));}?></span> ឆ្នាំ 
			             			កាន់<?php echo $this->agreement['joint_doc_type'];?>លេខ <span class="value" style="min-width:100px;"><?php echo $this->agreement['rid_no'];?></span>
			             			មានទីលំនៅបច្ចុប្បន្ន ផ្ទះលេខ  <span class="value" style="min-width:55px;"><?php echo $this->agreement['client_house_no'];?></span> ផ្លូវលេខ  <span class="value" style=""><?php echo $this->agreement['client_street'];?></span>
								  	 ក្រុមទី/ភូមិ <span class="value" style="min-width:50px;"><?php echo $this->agreement['client_village_kh'];?></span>       
								           សង្កាត់/ឃុំ  <span class="value" style="min-width:100px;"><?php echo $this->agreement['client_commune_kh'];?></span> 
								          ខ័ណ្ឌ/ស្រុក <span class="value" style="min-width:100px;"><?php echo $this->agreement['client_districtkh'];?></span>
             					          ក្រុង/ខេត្ត <span class="value" style="min-width:100px;">&nbsp;<?php echo $this->agreement['client_province_kh'];?></span> ។
		             				<br/>
		             				លក់ក្នុងតម្លៃ USD <span class="value" style="min-width:100px;font-weight: bolder;"><?php echo number_format($this->agreement['price_sold'],2);?></span> <strong>ជាអក្សរ ( <span id="lable_pricekhmer" style="font-family:'Khmer os battambang';"></span>ដុល្លារអាមេរិក )</strong> ។
		             		</li>
		             	</ol>
             		<p style="margin-top: -10px;">
             			<script>
							a_sold ='<?php echo ($this->agreement['price_sold']) ?>';
							money_khmersold=read_money_in_khmer(a_sold);
							decimalmoney_khmersold='<?php echo substr(number_format($this->agreement['price_sold'],2),-2);?>';
							str_centsold = 'សេន';
							if(decimalmoney_khmersold>0){string_sold='និង';}else{string_sold="";str_cent_sold='';}
							last_number_sold='<?php echo substr(number_format($this->agreement['price_sold'],2),-2);?>';
							
							if(last_number_sold<=0){last_number_sold='';}
							money_khmersold = money_khmersold+" "+string_sold+" "+read_in_khmer_from_10_to_99(decimalmoney_khmersold)+''+read_in_khmer_from_0_to_9(last_number_sold)+''+str_cent_sold;
							dojo.byId('lable_pricekhmer').innerHTML=money_khmersold+" ";
							
					</script>
             		</p>
             		<p style="margin-top: -10px;">
             			<ol style="list-style-type: cambodian;text-align:justify; " start="2">
             				<li>ភាគីទាំងពីរបានព្រមព្រៀងទូទាត់ប្រាក់ តាមដំណាក់កាលដូចខាងក្រោម ៖
	             				<ul style="list-style-type: square;text-align:justify; margin-bottom: 20px;" start="1">
		             				<li >
		             					<?php $dbs = new Loan_Model_DbTable_DbLandpayment();
					             			$resultdeposit = $dbs->getDepositFirstPaymentMoney($this->agreement['id']);
					             			$start_id=0;
					             			$paid_amount=0;
					             			$rowpaid = $dbs->getPaymentPayoff($this->agreement['id']);
					             			$paid_payoff = $rowpaid['outstanding'];
					             			$paid = 0;
					             			?>
					             			<?php if(!empty($resultdeposit) AND $this->agreement['is_reschedule']==1){?><!-- ប្រាក់កក់ -->
					             			<?php foreach($resultdeposit as $keydeposite =>$rsdeposite){?>
						             			<span style="display: block;" >ភាគីអ្នកទិញត្រូវកក់ទឹកប្រាក់ចំនួនUSD <span class="value" style="min-width:250px;font-family:Arial;font-weight: bold;"><?php echo @number_format($rsdeposite['total_principal_permonthpaid'],2);?>
						             				<strong>
						             				(<span style="font-family:'Khmer OS Battambang'" id="lable_depositpaid<?php echo $keydeposite+1;?>"></span>
						             				<span  style="font-family:'Khmer OS Battambang'">ដុល្លាអាមេរិក</span>)
						             				</strong>
					             				</span>
					             				នៅថ្ងៃ <?php echo $day[date("D",strtotime($rsdeposite['date_input']))]." ទី ".date("d",strtotime($rsdeposite['date_input']))." ខែ ".$month[date("m",strtotime($rsdeposite['date_input']))]." ឆ្នាំ ".date("Y",strtotime($rsdeposite['date_input'])); ?>
					             				</span>
					             				 <script>
													a ='<?php echo ($rsdeposite['total_principal_permonthpaid']) ?>';
													money_khmer=read_money_in_khmer(a);
													decimalmoney_khmer='<?php echo substr(number_format($rsdeposite['total_principal_permonthpaid'],2),-2);?>';
													str_cent = 'សេន';
													if(decimalmoney_khmer>0){string='និង';}else{string="";str_cent='';}
													
													last_number='<?php echo substr(number_format($rsdeposite['total_principal_permonthpaid'],2),-2);?>';
													
													if(last_number<=0){last_number='';}
													money_khmer = money_khmer+""+string+" "+read_in_khmer_from_10_to_99(decimalmoney_khmer)+''+read_in_khmer_from_0_to_9(last_number)+''+str_cent;
													dojo.byId('lable_depositpaid<?php echo $keydeposite+1;?>').innerHTML=money_khmer;
												</script>
												<?php 
												$paid_amount = $paid_amount+$rsdeposite['total_principal_permonthpaid'];
					             				}
					             			}?>
					             				<?php 
							             			$i=0; $numrow = 0;
							             			if (!empty($this->sale_schedule))  foreach ($this->sale_schedule as $key=> $row){$i++;  ?>
							             			<?php 
							             			if($row['is_completed']==1 AND $this->agreement['is_reschedule']==3){continue;}
							             			
							             			$paid = $paid+$row['principal_permonth'];?>    
							             			
							             			<?php if ($paid_amount>=$paid){
							             				continue;
							             			}
							             			?>         	
							             			<?php if($key==0){?>
								             		<?php
								             			if($row['date_payment']==$this->agreement['buy_date'] AND $paid_amount==$row['principal_permonth'] ){
								             				continue;
								             			}
							             				$paidbefore = $row['principal_permonth']-$paid_amount;
							             				if(strlen($paidbefore)<=3){$row['principal_permonth']=number_format($paidbefore,2);}
							             				else{
							             					$row['principal_permonth'] = ($paidbefore);
							             				}
							             			}?>
							             			</li>
							             			<li>
								             			<?php 
								             				$numrow=$numrow+1;?>
								             				<span  >ទឹកប្រាក់ចំនួនUSD 
								             					<span class="value" style="min-width:250px;font-family:Arial;font-weight: bold;"><?php echo @number_format($row['principal_permonth'],2);?>
								             					<strong>
									             					(<span style="font-family:'Khmer OS Battambang'" id="lable_depositkhmer<?php echo $i;?>"></span>
									             					<span  style="font-family:'Khmer OS Battambang'">ដុល្លាអាមេរិក</span>)
								             					</strong>
								             					</span>
								             					
								             					<span style="font-weight: normal !important;">&nbsp;&nbsp;អ្នកទិញត្រូវបង់នៅថ្ងៃ <?php echo $day[date("D",strtotime($row['date_payment']))]." ទី ".date("d",strtotime($row['date_payment']))." ខែ ".$month[date("m",strtotime($row['date_payment']))]." ឆ្នាំ ".date("Y",strtotime($row['date_payment'])); ?></span>
								             				</span>
								             				 <script>
																a ='<?php echo ($row['principal_permonth']) ?>';
																money_khmer=read_money_in_khmer(a);
																decimalmoney_khmer='<?php echo substr(number_format($row['principal_permonth'],2),-2);?>';
																str_cent = 'សេន';
																if(decimalmoney_khmer>0){string='និង';}else{string="";str_cent='';}
																
																last_number='<?php echo substr(number_format($row['principal_permonth'],2),-2);?>';
																
																if(last_number<=0){last_number='';}
																money_khmer = money_khmer+""+string+" "+read_in_khmer_from_10_to_99(decimalmoney_khmer)+''+read_in_khmer_from_0_to_9(last_number)+''+str_cent;
																dojo.byId('lable_depositkhmer<?php echo $i;?>').innerHTML=money_khmer;
															</script>
															<?php if($row['ispay_bank']==1){?>
									             				<span class="padding-left"  >&nbsp;&nbsp;&nbsp;<?php echo $this->keyValue['bank_info'];?></span>
									             			<?php break;
									             			}?>
								             				<?php 
								                       }?>
							                       </li>
							                       <?php
								  if($this->agreement['payment_id']==4){
								  ?>
							             <li>
							         		  ហើយ  ភាគីអ្នកទិញ យល់ព្រមបង់រំលស់ទឹកប្រាក់ដែលនៅសល់ចំនួន  <span class="value" style="min-width: 50px;"><strong><?php echo number_format(($this->agreement['price_sold']-$paid),2);?></strong></span> USD <strong>(<span class="value" style="min-width: 50px;"><span id="lable_remainkhmer" style="font-family: 'Times New Roman','Khmer OS Battambang'"></span> </span>ដុល្លារអាមេរិក)</strong>
										  	  រយៈពេល <?php echo number_format($this->agreement['total_duration'],0); //$dbparmeter->getNumberInkhmer(number_format($this->agreement['total_duration'],0));?>
										  	 <?php if($this->agreement['payment_id']!=4){
													echo $tr->translate("MONTH");
												}else{
													echo ($dataterm['install_by']==12)?$tr->translate("YEAR"):$tr->translate("MONTH");
											}?> 
										  	  ចាប់ផ្ដើមបង់ចាប់ពីថ្ងៃទី <?php echo date("d",strtotime($this->agreement['first_payment']));?> ខែ <?php echo $month[date("m",strtotime($this->agreement['first_payment']))];?> ឆ្នាំ <?php echo date("Y",strtotime($this->agreement['first_payment']));?>
										            តាមតារាងបង់ប្រាក់រំលស់(ឧបសម្ព័ន១)។
											<script>
											     <?php $remain = $this->agreement['price_sold']-$paid;?>
												a ='<?php echo $remain; ?>';
												money_khmer=read_money_in_khmer(a);
												decimalmoney_khmer='<?php echo substr(number_format($remain,2),-2);?>';
												str_cent = 'សេន';
											
												if(decimalmoney_khmer>0){string='និង';}else{string="";str_cent=""}
												
												last_number='<?php echo substr(number_format($remain,2),-1);?>';
												
												if(last_number<=0){last_number='';}
												money_khmer = money_khmer+" "+string+" "+read_in_khmer_from_10_to_99(decimalmoney_khmer)+''+read_in_khmer_from_0_to_9(last_number)+''+str_cent;
												dojo.byId('lable_remainkhmer').innerHTML=money_khmer;
											</script>
							             </li>
							             <?php }?>
	             				</ul>
             				</li>
             				
             			</ol>
												    
             		<ol style="list-style-type: cambodian;text-align:justify; margin-bottom: 20px;" start="3">
             			<li style="white-space: nowrap; margin-bottom: 20px;">
             				ភាគីអ្នកលក់ នឹងប្រគល់លិខិតបំបែកក្បាលដី អោយភាគីអ្នកទិញ បើរដ្ឋតម្រូវអោយបង់ពន្ធ និងធ្វើកម្មសិទ្ធ ជាបន្ទុករបស់អ្នកទិញ។
             			</li>
             			<li style="margin-bottom: 20px;">ក្នុងករណី ភាគីអ្នកទិញ ពុំបានប្រគល់ប្រាក់គ្រប់ចំនួនតាមថ្ងៃកំណត់ ឬកែប្រែឈប់ទិញវិញនោះប្រាក់ដែលបាន ប្រគល់ទាំងប៉ុន្មានត្រូវទុកជាអសារបង់។</li>
             			<li style="margin-bottom: 20px;">ក្នុងករណីភាគី អ្នកលក់កែប្រែតម្លៃ ឫឈប់លក់វិញនោះភាគី អ្នកលក់ត្រូវសងជាទឹកប្រាក់ ចំនួនស្មើនឹង ៣ដង (បីដង) នៃទឹកប្រាក់ដែលបានទទួលពីភាគីអ្នកទិញ។</li>
             		</ol>
					<p style=" margin-bottom: 20px; font-size: 21px;">
					<span style="font-family:'Khmer OS Muol';text-decoration: underline;padding-left:50px;"></span>ដើម្បីអះអាងកិច្ចសន្យានេះមានប្រសិទ្ធភាព ភាគីទាំងពីរសូមផ្តិតមេដៃទុកជាភស្តុតាង។
             		</p>
             		<p style=" text-align: right;  margin-bottom: 30px; font-size: 20px;"><!-- margin-top: -20px; -->
             			ធ្វើនៅថ្ងៃទី<span class="value" style="min-width:50px;"> <?php echo date("d",strtotime($this->agreement['agreement_date']));?></span> ខែ <span class="value" style="min-width:50px;"> <?php echo $month[date("m",strtotime($this->agreement['agreement_date']))];?></span> ឆ្នាំ <span class="value" style="min-width:50px;"> <?php echo date("Y",strtotime($this->agreement['agreement_date']));?></span>
             		</p>
             		<p style="font-size: 20px;"><!-- style="margin-top: -15px;" -->
             			<div style="width:24%; text-align: center; display: inline-block;font-family: 'Khmer OS Battambang';font-weight: bold; font-size: 21px;">
             				<span class="value">ស្នាមមេដៃសាក្សីទី១</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;font-family: 'Khmer OS Battambang';font-weight: bold; font-size: 21px;">
             				<span class="value">ស្នាមមេដៃសាក្សីទី២</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;font-family: 'Khmer OS Battambang';font-weight: bold; font-size: 21px;">
             				<span class="value">ស្នាមមេដៃអ្នកទិញ</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;font-family: 'Khmer OS Battambang';font-weight: bold; font-size: 21px;">
             				<span class="value">ស្នាមមេដៃអ្នកលក់</span>
             			</div>
             			<div style="height: 90px;">
             			</div>
             			
             			<div style="width:24%; text-align: center; display: inline-block;">
             				<span class="border_bt  value" style="width:75%;" >&nbsp;</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;">
             				<span class="border_bt  value" style="width:75%;" >&nbsp;</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;">
             				<span class="border_bt  value" style="width:80%;white-space: nowrap;text-align: center; font-size: 21px;" >&nbsp;&nbsp;<?php echo $this->agreement['client_namekh'];echo (!empty($this->agreement['hname_kh']))?"/".$this->agreement['hname_kh']:"";?>&nbsp;</span>
             			</div>
             			<div style="width:24%; text-align: center; display: inline-block;">
             				<span class="border_bt  value" style="width:75%; font-size: 21px;" >&nbsp;<?php //echo $this->agreement['project_manager_namekh'];?></span>
             			</div>
             		</p>
             	</td>
             </tr>
        </table>
        </div>
    </td>	
</tr>
</table>
</div>