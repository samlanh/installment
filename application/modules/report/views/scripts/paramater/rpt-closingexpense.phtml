<?php 
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$frm = $this->frm_search;
	
	$dbGB = new Application_Model_DbTable_DbGlobal();
	$logo = $this->baseUrl()."/images/logo.jpg";
	$branch_title = $tr->translate("BRAND_TITLE");
	if ($this->search['branch_id'] >0 ){
		$branch = $dbGB->getAllBranchInfoByID($this->search['branch_id']);
		if (file_exists(PUBLIC_PATH."/images/projects/".$branch["logo"])){
			$logo = $this->baseUrl()."/images/projects/".$branch["logo"];
		}
		$branch_title = $branch['project_name'];
	}
	$expenseFeatureList = EXPENSE_FEATURE_LIST;
?>
<script>
	dojo.require("dijit.form.DateTextBox");
</script>
<meta charset="utf-8">
<title><?php echo $tr->translate("CLOSING_EXPENSE");?></title>
<div class="reportblog">
	<div class="card-box">
       	<div class="col-sm-12 border-botom">
	   		<div class="col-sm-8 pd-0">
	    		<h4 class="m-b-0"><i class="fa fa-file" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('CLOSING_EXPENSE');?></h4>
    		</div>
    		<div class="col-sm-4 text-right">
    		</div>
    	</div>
    </div>
	<form name="frm_rptstaff" action="" dojoType="dijit.form.Form" method="post">
		<div class="form-group">
        	<div class="col-md-3 col-sm-3 col-xs-12">
        		<?php echo $frm->getElement("adv_search");?>
        	</div>
        	<div class="col-md-3 col-sm-3 col-xs-12">
        		<?php echo $frm->getElement('branch_id');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement('supplier_id');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement('category_id_expense');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<?php echo $frm->getElement('payment_type');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12"></div>
        </div>
        <div class="form-group">
        	<div class="col-md-3 col-sm-3 col-xs-12">
        		<?php echo $frm->getElement('start_date');?>
        	</div>
        	<div class="col-md-3 col-sm-3 col-xs-12">
        		<?php echo $frm->getElement('end_date');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement('queryOrdering');?>
				<?php //echo $frm->getElement('ordering');?>
        	</div>
			<div class="col-md-2 col-sm-2 col-xs-12">
				<?php echo $frm->getElement('is_closed');?>
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        		<button iconclass="dijitIconSearch" dojoType="dijit.form.Button" showLabel="true" type="submit"><?php echo $tr->translate("SEARCH");?></button>
        	</div>
        	
        	<div class="col-md-2 col-sm-2 col-xs-12">
        	</div>
        	<div class="col-md-2 col-sm-2 col-xs-12">
        	</div>
        </div>        
	 </form> 
	<div style="min-height:22cm; margin:0 auto;">
	<table style="font-family: 'Times New Roman','Khmer OS Battambang'; width:100%;"  >
		<tr>
	    	<td align="center">
	    	 <div id="divPrint">
	    	 	<style>
				.style{
					line-height: 20px;font-size: 14px !important;
					font-family: 'Times New Roman','Khmer OS Battambang';
					}
					th{padding:1px;}
					.hide{visibility: hidden;}
						@media print {
						  div.divFooter {
						    position: fixed;
						    top: 0;
						  	width: 100%;
						  	height: 100px;
						  	bottom:0px;
							margin:0;
						 }
					.hide{visibility: visible; height: 110px;}
				}
				table.content-data{
					border-collapse:collapse;
					border:1px solid #000; 
					font-size:10px;
					font-family: 'Times New Roman','Khmer OS Battambang';
					white-space: nowrap;
					line-height: 22px;
				}
				table.content-data tr.style,
				table.content-data thead tr.style {
				   line-height: 25px; font-size:10px !important; padding:1px 0px; white-space: nowrap;height: 22px; 
					background: #c1d0f3;
				}
				table.content-data td{
					padding: 3px;
				}
				table.tb-footer{
					border-collapse:collapse;
					border:1px solid #000; 
					font-family: 'Times New Roman','Khmer OS Battambang';
					font-size:11px;
				}
				table.tb-footer tr{
				 line-height: 14px;  padding:1px 0px; height: 25px;
				}
						</style>
				<div class="divFooter">
		        	<table width="100%" style="font-family: 'Times New Roman','Khmer OS Battambang';margin:0; padding:0px;border:none;">
		            	<tr>
			                <td width="30%"><img src="<?php echo $logo;?>" style="max-height:85px;max-width:100%;"></td>
			                <td width="40%" valign="top">
			                <h2 style="text-align:center; font-size:<?php echo FONTSIZE_REPORT;?>; font-family:'Times New Roman','Khmer OS Muol Light'; font-weight: 200; "><?php echo $branch_title;?></h2>
			                <h2 style="text-align:center; font-size:<?php echo FONTSIZE_REPORT;?>; font-family:'Times New Roman','Khmer OS Muol Light';font-weight: 200;"><?php echo $tr->translate("CLOSING_EXPENSE");?></h2>
			                <p style="text-align:center; font-size:13px; font-family:'Times New Roman','Khmer OS Muol Light'; font-weight: 200; margin-top: -15px;"><?php if(!empty($this->search['start_date'])){ echo date("d-M-Y",strtotime($this->search['start_date'])).' '.$tr->translate('TO').' ';echo date("d-M-Y",strtotime($this->search['end_date']));}?></p>
			                </td>
		                	<td width="30%"></td>
		             	</tr> 
		            </table>
		        </div>
		        <form id="list" name="list" action="<?php echo $this->url(array('module'=>'report','controller'=>'paramater','action'=>'submitentryexpense')); ?>" dojoType="dijit.form.Form" method="post">
						<script type="dojo/method" event="onSubmit" >			
							id_selected = dijit.byId('id_selected').get('value');
							if(id_selected==''){
								alert('No record to close !!! ');
								return false;
							}
							loadingBlock();
							return true;
						</script>
	        	<table id="exportExcel"  width="100%" style="font-family:'Times New Roman','Khmer OS Battambang';margin:0; padding:0;border:none;" >
		            <tr>
	            	   <td colspan="3">
	            		<table class="content-data"  border="1" width="100%"  >  
					    	<thead>
					    		<tr class="hide" style="border:1px solid #000;">
						             <td colspan="12" style="border:1px solid #fff;border-bottom:1px solid #000;"></td>
						        </tr>
						        <?php 
								$countRow = count($this->row);
								if($expenseFeatureList==1){
								$countRow = count($this->rowExpensePayment);
								}
								
								$countCommission = count($this->rscomisison);
								$countRowCommissionPayment = count($this->rowCommissionPayment);
								$countHouserepair = count($this->houserepair);
								
								$count = $countRow+$countCommission+$countRowCommissionPayment+$countHouserepair;
								$k=0;
								$branch_id=''; $i=0; $total=0; 
							?>
								<tr>
									<td colspan="13" style="  border-top: solid 1px #fff;  border-left: solid 1px #fff;  border-right: solid 1px #fff;">
										<input type="checkBox" onclick="checkAll('<?php echo $count;?>');" name="checkall" id="checkall" />
										<input type="hidden" name="id_selected" id="id_selected" dojoType="dijit.form.TextBox" />
									</td>
								</tr>
								
							
							<?php if($expenseFeatureList==1){?>
							<?php 
				           if (!empty($this->rowExpensePayment)){?>
								<tr class="style" align="center">
									<td>&nbsp;<?php echo $tr->translate('NUM');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('BRANCH_NAME');?>&nbsp;</td>
									<td >&nbsp;<?php echo $tr->translate('SUPPLIER_NAME');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('PAYMENT_TYPE');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('CHEQUE_ISSUER');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('NUMBER');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('TOTAL_PAID');?>&nbsp;</td>
									<td colspan="2">&nbsp;<?php echo $tr->translate('NOTE');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('RECEIPT_NO');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('DATE');?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate('BY_USER');?>&nbsp;</td>
									<td><?php echo $tr->translate("STATUS");?></td>
								 </tr>
								 <?php $branch_id=''; $i=0; 
									foreach($this->rowExpensePayment as $key =>$rows){ $i++; $k++;
									?>
									<tr align="left" class="stylehover">
										<td align="center">
										<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $k;?>)" name="check_box<?php echo $k;?>" id="check_box<?php echo $k;?>" />
										<input type="hidden" id="id_<?php echo $k;?>" name="id_<?php echo $k;?>" value="<?php echo $rows['id'];?>" dojoType="dijit.form.TextBox" />
										<input type="hidden" id="type_record<?php echo $k;?>" name="type_record<?php echo $k;?>" value="5" dojoType="dijit.form.TextBox" /><!-- 1= Other Expense payment -->
									
									
									   <?php echo $i; ?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo $rows['branch_name'];?>&nbsp;</td>
										<td align="left">&nbsp;<?php echo $rows['supplier_name'];?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo $rows['paid_by'];?>&nbsp;</td>
										<td align="left">&nbsp;<?php echo $rows['cheque_issuer'];?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo $rows['cheque_no'];?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo number_format($rows['total_paid'],2);?>&nbsp;</td>
										<td colspan="2" align="left">&nbsp;<?php echo $rows['note'];?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo $rows['receipt_no'];?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo date("d-m-Y",strtotime($rows['date_payment']));?>&nbsp;</td>
										<td align="center">&nbsp;<?php echo $rows['user_name'];?>&nbsp;</td>
										<td class="">&nbsp;<?php echo($rows['is_closed']==0)?"Unclose":"Closed";?>&nbsp;</td>
									</tr>
									 <?php 
											$total = $total +$rows['total_paid'];
										?>
							   <?php }?>
						   <?php }?>
				   <?php }else{?>
							<?php if(!empty($this->row)){?>
						    	<tr bgcolor="#c1d0f3" class="style" align="center"  >
									<td>&nbsp;<?php echo $tr->translate("NUM");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("BRANCH_NAME");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("SUPPLIER");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("EXPENSE_TITLE");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("RECIEPT_NO");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("CATEGORY");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("TOTAL_EXPENSE");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("PAYMENT_TYPE");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("CHEQUE_NUMBER");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("NOTE");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("DATE");?>&nbsp;</td>
								    <td>&nbsp;<?php echo $tr->translate("BY_USER");?>&nbsp;</td>
								    <td><?php echo $tr->translate("STATUS");?></td>
								</tr>
							</thead>
					       <?php  foreach($this->row as $key =>$row){ $i++; $k++;?>
							<tr align="left" class="stylehover">
							   <td align="center">&nbsp;
							   		<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $k;?>)" name="check_box<?php echo $k;?>" id="check_box<?php echo $k;?>" />
									<input type="hidden" id="id_<?php echo $k;?>" name="id_<?php echo $k;?>" value="<?php echo $row['id'];?>" dojoType="dijit.form.TextBox" />
									<input type="hidden" id="type_record<?php echo $k;?>" name="type_record<?php echo $k;?>" value="1" dojoType="dijit.form.TextBox" /><!-- 1= Other Expense -->
												
							   <?php echo $i; ?></td>
							   <td align="center"  style="white-space:nowrap"><?php echo $row['branch_name'];?></td>
							   <td  style="white-space:nowrap">&nbsp;<?php echo $row['supplier_name'];?>&nbsp;</td>
							   <td style="line-height: 18px;white-space: normal !important; max-width: 150px;width: 150px;padding: 2px;overflow-wrap: break-word;"><?php echo $row['title'];?></td>
							   <td align="center">&nbsp;<?php echo $row['invoice'];?></td>
							   <td style="line-height: 18px;white-space: normal !important; max-width: 150px;width: 150px;padding: 2px;overflow-wrap: break-word;"><?php echo $row['category_name'];?></td>
							   <td align="center">&nbsp;<?php echo number_format($row['total_amount'],2);?></td>
							   <td align="center">&nbsp;<?php echo $row['payment_type'];?></td>
							   <td align="center">&nbsp;<?php echo $row['cheque'];?></td>
							   <td align="center" style="line-height: 18px;white-space: normal !important; max-width: 200px;width: 200px;padding: 2px;overflow-wrap: break-word;"><?php echo $row['description'];?></td>
							   <td align="center" style="white-space: nowrap;">&nbsp;<?php echo date("d-M-Y",strtotime($row['date']));?></td>
							   <td align="center">&nbsp;<?php echo $row['user_name'];?></td>
							   <td class="">&nbsp;<?php echo($row['is_closed']==0)?"Unclose":"Closed";?>&nbsp;</td>
							</tr>
								<?php $total = $total +$row['total_amount'];?>
							<?php }?>
							<?php }?>
				   <?php }?>
				   
							<?php if(!empty($this->rscomisison)){?>
							<tr  style="font-size: 12px; line-height:20px;">
							   <td align="center" colspan="13">
								<span style="font-weight:normal;font-size:12px; font-family:'Times New Roman','Khmer OS Muol Light'"><?php echo $tr->translate("COMMISSION");?></span>
							   </td>
							 </tr>
							 <tr class="style" align="center" >
					        	<td><?php echo $tr->translate("NUM");?></td>
						        <td><?php echo $tr->translate("BRANCH_NAME");?></td>
						        <td colspan="2"><?php echo $tr->translate("STAFF_NAME");?></td>
								<td><?php echo $tr->translate("SEX");?></td>
						        <td colspan="2"><?php echo $tr->translate("TEL");?></td>
						        <td colspan="2"><?php echo $tr->translate("PROPERTY_CODE");?></td>
						        <td><?php echo $tr->translate("COMISSION");?></td>
						        <td><?php echo $tr->translate("DATE");?></td>
						        <td><?php echo $tr->translate("BY_USER");?></td>
						        <td><?php echo $tr->translate("STATUS");?></td>
				         	</tr>
							<?php  
								$key=0; 
								$record = $key;
								foreach($this->rscomisison as $key => $rscom){ $k++;?>
								<?php 
									$total = $total +$rscom['total_amount'];
								?>
								 <tr align="left" class="stylehover">
									 <td align="center">&nbsp;
											<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $k;?>)" name="check_box<?php echo $k;?>" id="check_box<?php echo $k;?>" />
											<input type="hidden" id="id_<?php echo $k;?>" name="id_<?php echo $k;?>" value="<?php echo $rscom['id'];?>" dojoType="dijit.form.TextBox" />
											<input type="hidden" id="type_record<?php echo $k;?>" name="type_record<?php echo $k;?>" value="2" dojoType="dijit.form.TextBox" /><!-- 1= Commssion -->
									 
									 <?php echo $key+1+$record; ?>&nbsp;</td>
									 <td align="center">&nbsp;<?php echo $rscom['project_name']?>&nbsp;</td>
									 <td colspan="2">&nbsp;<?php echo $rscom['staff_name'];?>&nbsp;</td>
									 <td align="center">&nbsp;<?php if($rscom['sex']==1){ echo "ប្រុស";}else{ echo 'ស្រី';}?>&nbsp;</td>
									 <td colspan="2" align="center">&nbsp;<?php echo $rscom['tel'];?>&nbsp;</td>
									 <td colspan="2" style="white-space: nowrap;">&nbsp;<?php echo $rscom['land_address'].', '.$rscom['street'];?>&nbsp;</td>
									 <td align="right">&nbsp;<?php echo '$ '.number_format($rscom['total_amount'],2);?>&nbsp;</td>
									 <td style="white-space: nowrap;">&nbsp;<?php echo date("d-M-Y",strtotime($rscom['create_date']));?>&nbsp;</td>
									 <td align="center">&nbsp;<?php echo $rscom['user_name'];?></td>
									 <td class="">&nbsp;<?php echo($rscom['is_closed']==0)?"Unclose":"Closed";?>&nbsp;</td>
								</tr>
								<?php } ?>
							 <?php }?>
							 <?php if(!empty($this->rowCommissionPayment)){?>
								 <tr  style="font-size: 12px; line-height:20px;">
								   <td align="center" colspan="13">
									<span style="font-weight:normal;font-size:12px; font-family:'Times New Roman','Khmer OS Muol Light'"><?php echo $tr->translate("COMMISSION_PAYMENT");?></span>
								   </td>
								 </tr>
								 <tr class="style" align="center" >
									<td><?php echo $tr->translate("NUM");?></td>
									<td><?php echo $tr->translate("BRANCH_NAME");?></td>
									<td colspan="2" ><?php echo $tr->translate("STAFF_NAME");?></td>
									<td>&nbsp;<?php echo $tr->translate("RECIEPT_NO");?>&nbsp;</td>
									<td ><?php echo $tr->translate("CATEGORY");?></td>
									
									<td ><?php echo $tr->translate("COMISSION");?></td>
									<td>&nbsp;<?php echo $tr->translate("PAYMENT_TYPE");?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate("NUMBER");?>&nbsp;</td>
									<td>&nbsp;<?php echo $tr->translate("CHEQUE_ISSUER");?>&nbsp;</td>
									
									
									<td ><?php echo $tr->translate("DATE");?></td>
									<td><?php echo $tr->translate("BY_USER");?></td>
									<td><?php echo $tr->translate("STATUS");?></td>
								</tr>
								<?php $c=0; foreach ($this->rowCommissionPayment AS $rs){ $c++; $k++; $total = $total +$rs['total_paid']; ?>
									<tr align="left" class="stylehover">
										 <td align="center">&nbsp;<?php echo $c; ?>
											<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $k;?>)" name="check_box<?php echo $k;?>" id="check_box<?php echo $k;?>" />
											<input type="hidden" id="id_<?php echo $k;?>" name="id_<?php echo $k;?>" value="<?php echo $rs['id'];?>" dojoType="dijit.form.TextBox" />
											<input type="hidden" id="type_record<?php echo $k;?>" name="type_record<?php echo $k;?>" value="3" dojoType="dijit.form.TextBox" />
									
										 </td>
										 <td align="center">&nbsp;<?php echo $rs['branch_name']?>&nbsp;</td>
										 <td colspan="2">&nbsp;<?php echo $rs['staff_name'];?> <?php //if($rs['sex']==1){ echo "(ប្រុស)";}else{ echo '(ស្រី)';} echo empty($rs['tel'])?"":" ".$rs['tel'];?> &nbsp;</td>
										 <td align="center">&nbsp;<?php echo $rs['receipt_no'];?>&nbsp;</td>
										 <td >&nbsp;<?php echo $rs['category_name'];?>&nbsp;</td>
										 
										 <td align="right">&nbsp;<?php echo number_format($rs['total_paid'],2);?>&nbsp;</td>
										 <td align="center">&nbsp;<?php echo $rs['payment_type'];?></td>
										 <td align="center">&nbsp;<?php echo $rs['cheque_no'];?></td>
										 <td align="center">&nbsp;<?php echo $rs['cheque_issuer'];?></td>
							   
										 
										 <td align="center" style="white-space: nowrap;">&nbsp;<?php echo date("d-m-Y",strtotime($rs['date_payment']));?>&nbsp;</td>
										 <td align="center">&nbsp;<?php echo $rs['user_name'];?></td>
										 <td class="">&nbsp;<?php echo($rs['is_closed']==0)?"Unclose":"Closed";?>&nbsp;</td>
									</tr>
								 <?php }?>
						 
							<?php }?>
							 <?php 
									if (!empty($this->houserepair)){
								?>
								<tr  style="font-size: 12px; line-height:20px;">
								   <td align="center" colspan="13">
									<span style="font-weight:normal;font-size:12px; font-family:'Times New Roman','Khmer OS Muol Light'"><?php echo $tr->translate("ចំណាយពីការកែផ្ទះ");?></span>
								   </td>
								 </tr>
								 <tr class="style" align="center"  >
									<td><?php echo $tr->translate("NUM");?></td>
									<td><?php echo $tr->translate("BRANCH_NAME");?></td>
									<td ><?php echo $tr->translate("EXPENSE_TITLE");?></td>
									<td><?php echo $tr->translate("RECEIPT_NO");?></td>
									<td><?php echo $tr->translate("CLIENT_NAME");?></td>
									<td><?php echo $tr->translate("PROPERTY_CODE");?></td>
									<td><?php echo $tr->translate("CATEGORY");?></td>
									<td><?php echo $tr->translate("TOTAL");?></td>
									<td><?php echo $tr->translate("CHEQUE");?></td>
									<td><?php echo $tr->translate("NOTE");?></td>
									<td><?php echo $tr->translate("DATE");?></td>
									<td><?php echo $tr->translate("BY_USER");?></td>
									<td><?php echo $tr->translate("STATUS");?></td>
								</tr>
								 <?php foreach ($this->houserepair as $index => $rs){ $k++;?>
								
								<tr class=" stylehover <?php //if($index%2==1){echo"even";}?>" style=" <?php if ($rs['status']==0){ echo "background: #f7c6c6;";}?>  font-family: 'Times New Roman','Khmer OS Battambang';white-space: nowrap;" width="100%">
									<td style="text-align: center;">&nbsp;<?php echo $index+1; ?>&nbsp;
									
											<input style="height: 15px;margin-top: 5px;" type="checkBox" onClick="checked_id(<?php echo $k;?>)" name="check_box<?php echo $k;?>" id="check_box<?php echo $k;?>" />
											<input type="hidden" id="id_<?php echo $k;?>" name="id_<?php echo $k;?>" value="<?php echo $rs['id'];?>" dojoType="dijit.form.TextBox" />
											<input type="hidden" id="type_record<?php echo $k;?>" name="type_record<?php echo $k;?>" value="4" dojoType="dijit.form.TextBox" />
											
									</td>
									<td align="center">&nbsp;<?php echo $rs["branch_name"];?>&nbsp;</td>
									<td align="center">&nbsp;<a target="_blank" style="color:#000;text-decoration: none;" href="<?php echo $this->url(array('module'=>'report','controller'=>'loan','action'=>'receipt-otherincome','id'=>$rs['id']));?>?repair=1"><?php echo $rs["title_income"];?></a>&nbsp;</td> 
									<td align="center">&nbsp;<a target="_blank" style="<?php if ($rs['status']==0){ echo "color:red;";}else{ echo "color:#000;";}?>text-decoration: none;" href="<?php echo $this->url(array('module'=>'report','controller'=>'loan','action'=>'receipt-otherincome','id'=>$rs['id']));?>?repair=1"><?php echo $rs["invoice"];  if ($rs['status']==0){ echo " ".$tr->translate("មោឃៈ");}?></a>&nbsp;</td>
									<td align="center">&nbsp;<a target="_blank" style="color:#000;text-decoration: none;" href="<?php echo $this->url(array('module'=>'report','controller'=>'loan','action'=>'receipt-otherincome','id'=>$rs['id']));?>?repair=1"><?php echo $rs["name_kh"];?></a>&nbsp;</td> 
									<td align="center">&nbsp;<?php echo $rs["land_address"]." (".$rs["street"].")";?>&nbsp;</td>
									<td valign="top">&nbsp;<?php echo $rs["category"];?>&nbsp;</td>
									<td align="center">&nbsp;<strong><?php  if ($rs['status']==0){ echo "-";}else{ echo number_format(abs($rs["total_amount"]),2);}?></strong>&nbsp;</td>
									<td>&nbsp;<?php echo $rs["cheque"];?>&nbsp;</td>
									<td>&nbsp;<?php echo $rs["description"];?>&nbsp;</td>
									<td align="center">&nbsp;<?php echo date("d-M-Y",strtotime($rs["date"]));?>&nbsp;</td>
									<td align="center">&nbsp;<?php echo $rs["user_name"];?>&nbsp;</td>
									<td class="">&nbsp;<?php echo($rs['is_close']==0)?"Unclose":"Closed";?>&nbsp;</td>
								</tr>
								 <?php 
								if ($rs['status']!=0){
									$total = $total + abs($rs['total_amount']);
								}
							   ?>
								<?php }?>
							<?php }?>
					    </table>
				    
	            	</td>
	            </tr>
	            <tr style=" border-bottom: solid 1px #fff; border-left: solid 1px #fff;  border-right: solid 1px #fff;">
					<td colspan="11">
						<table align="right" style="margin-right: 6px;">
							  <tr style="font-size:14px; color:#000; height: 18px;"​ align="center">
								<td style="  width:146px;  font-size: 14px;">&nbsp;<?php echo $tr->translate('TOTAL_EXPENSE');?>&nbsp;</td>
								<td style=" background: rgba(249, 225, 11, 0.7);  color:#000; width:112px; font-size: 14px;"></td>
								<td style="background: rgba(249, 225, 11, 0.7); color:#000; width:112px; font-size: 14px;">$ <?php echo number_format($total,2);?></td>
							  </tr>
						</table>
					</td>
				</tr>
				<tr style=" border-bottom: solid 1px #fff; border-left: solid 1px #fff;  border-right: solid 1px #fff;">
						<td colspan="11" align="center">
							 <button iconclass="dijitIconSave" dojoType="dijit.form.Button" showLabel="true" type="submit">Closing Entry</button>
						</td>
					</tr>
	            </table>
	            </form>
				<br />
				<?php echo $this->footerReport;?>
			</div>
	    </td>
	   </tr>
   </table>
	</div>
</div>
<?php $urlprint = $this->baseUrl()."/report/loan/receipt-expense/id/";?>
<script type="text/javascript">
var row=0;
var url="";
$(function(){
	$.contextMenu({
		selector: '.context-menu-one', 
		callback: function(key, options) {
			var m = "clicked: " + key;
			if(key=="print"){
				url='<?php echo $urlprint;?>';
			
			}
			gotoAction();
		},
		items: {
			"print": {name: "<?php echo $tr->translate("PRINT");?>", icon: "fa-print", accesskey: "c o p y"},
		}
	});
});
function setrowdata(index){
	row = index;
}
var recordid ='';
function gotoAction(){
	 window.open(url+row+'?rightclick=true', '_blank');
}

function checkAll(array_length){
	dijit.byId('id_selected').attr('value','');
	if(dojo.byId('checkall').checked){
		for(var j=1;j<=array_length;j++){
			$('#check_box'+j).each(function() { 
				this.checked = true;  
			});
			checked_id(j);
		}
	}else{
		for(var j=1;j<=array_length;j++){
			$("#check_box"+j).removeAttr("checked");
			checked_id(j);
		}
	}
}

function checked_id(index){
	row_id = index;//dijit.byId('id_'+index).get('value');
	if(dojo.byId('check_box'+index).checked){
		if($("#id_selected").val()!="") {
			var identity = $("#id_selected").val();
			$("#id_selected").val(identity+','+row_id);
		}else{
			$("#id_selected").val(row_id);
		}
	}else{
		var identity = $('#id_selected').val();
		var arrays = identity.split(',');
		for(var i=0;i<arrays.length;i++) {
		if(arrays[i] == row_id) arrays.splice(i,1);
		}
		var strings = arrays.join(',');
		$('#id_selected').val(strings);
	}
}
</script>
