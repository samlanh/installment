<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate("REQUEST_LETTER")); 
	echo $this->headTitle();
	
	$month = array("01"=>"មករា","02"=>"កុម្ភៈ","03"=>"មីនា","04"=>"មេសា","05"=>"ឧសភា","06"=>"មិថុនា","07"=>"កក្កដា","08"=>"សីហា","09"=>"កញ្ញា","10"=>"តុលា","11"=>"វិច្ឆិកា","12"=>"ធ្នូ",);
	$dbparmeter = new Report_Model_DbTable_DbParamater();
?>
<div class="reportblog">
	<div class="card-box">
		<div class="col-sm-12 border-botom">
			<div class="col-sm-8 pd-0">
				<h4 class="m-b-0"><i class="fa fa-file-text" aria-hidden="true"></i> <?php echo $tr->translate('REQUEST_LETTER');?></h4>
			</div>
			<div class="col-sm-4 text-right">
			</div>
		</div>
	</div>
	<div class="card-box">
		<div id="divPrint">
			<style>
				table.tableTop tr td,span {
					font-size:12px ;
					font-family: 'Times New Roman','Khmer OS Battambang';
				}
				table.tableTop tr td span.project-name{
					font-size:12px ;
					font-family:"Times New Roman","Khmer OS Muol Light";
				}
				table tr td{
					padding:0 2px;
					line-height: 14px;
				}
				table.content-data{
					border-collapse:collapse;
					border:1px solid #000; 
					font-size:13px;
				}
				table.content-data thead tr.style {
				   line-height: 25px; font-size:12px !important; padding:1px 0px; white-space: nowrap;height: 22px; 
					background: #c1d0f3;
					font-weight:600;
				}
				table.content-data tr td{
					padding:5px 1px;
				}
				table.requestInfo {
					width: 100%;
				}
				table.requestInfo tr td {
					vertical-align: top;
				}
				table.requestInfo span.lbTitle {
					font-weight: 600;
				}
				tr.style.rejected {
					background: #ffcece;
				}
			</style>
				
			<table class="tableTop" width="100%" >
				<tr>
					<td width="30%" id="projectlogo">
						<br />
						<img style="height:85px; max-width: 100%;" src="/camappgit/installment/public/images/projects/logo202206131655107725.png">
					</td>
					<td width="40%" valign="top" style=" padding-bottom: 40px;">
					</td>
					<td width="30%" align="right" style="vertical-align:top;">
						<span class="project-name" id="projectName">(បុរី រំចេកក្រាំងពង្រ)</span>
					</td>
				</tr> 
				<tr>
					<td colspan="3" align="center">
						<span style='font-family: "Times New Roman","Khmer OS Muol Light";' ><?php echo $tr->translate("ប័ណ្ណស្នើសុំបញ្ជារទិញទំនិញ");?></span>
					</td>
				</tr>
				<tr>
					<td colspan="3" style="position:relative;" >
					<?php 
						$rejected=0;
						if($this->row["checkingStatus"]==2){
							$rejected=1;
						}
						if($this->row["pCheckingStatus"]==2){
							$rejected=1;
						}
						if($this->row["approveStatus"]==2){
							$rejected=1;
						}
					?>
						<?php if($rejected==1){?>
						<div style="opacity: 1;position: absolute;display: block;background-size: 80%;z-index: 12;font-size: 40px;color: #f00;transform: rotate(-50deg);border: solid 5px #f00;padding: 26px;top: 110px;left: 237px;" ><?php echo $tr->translate("REJECTED_STASUS");?></div>
						<?php }?>
						<table class="requestInfo">
							<tr>
								<td width="30%"><span class="lbTitle"><?php echo $tr->translate("REQUEST_NO");?></span> : <span style="color:red; font-weight:600;"><?php echo $this->row["requestNo"];?></span></td>
								<td width="40%">&nbsp;</td>
								<td width="30%"><span class="lbTitle"><?php echo $tr->translate("REQUEST_NO_FROM");?></span> : <span><?php echo $this->row["requestNoLetter"];?></span></td>
								
							</tr>
							<tr>
								<td ><span class="lbTitle"><?php echo $tr->translate("DATE");?></span> : <span><?php echo date("d-M-Y",strtotime($this->row["date"]));?></span></td>
								<td></td>
								<td ><span class="lbTitle"><?php echo $tr->translate("PURPOSE");?></span> : <span><?php echo $this->row["purpose"];?></span></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="3" >
						<table class="content-data" width="100%" border="1"  cellspacing="0" cellpadding="0">
							<thead>
								<tr class="style" align="center" >
									<td class="center"><?php echo $tr->translate("NUM");?></td>
									<td class="center" style="width:200px;"><?php echo $tr->translate("PRODUCT_NAME");?></td>
									<td class="center"><?php echo $tr->translate("CATEGORY");?></td>
									<td class="center"><?php echo $tr->translate("QTY_REQUEST");?></td>
									<td class="center"><?php echo $tr->translate("QTY_APPROVED");?></td>  
									<td class="center"><?php echo $tr->translate("UNIT");?></td>
									<td class="center"><?php echo $tr->translate("DATE_ENTRY");?></td>		
									<td class="center" style="width:150px;"><?php echo $tr->translate("OTHER");?></td>    
								</tr>
							</thead>
							 <?php 
							 $i=0;
				                if(!empty($this->rowdetail)) foreach ($this->rowdetail as $index => $rs){ $i++;
								
								$qtyApproved=$rs["qtyAdjust"];								
								$classRow="";
								if($rs["adjustStatus"]==2){
									$classRow="rejected";
									$qtyApproved=0;
								}
								
								if($rs["approvedStatus"]==2){
									$classRow="rejected";
									$qtyApproved=0;
								}else if($rs["approvedStatus"]==1){
									$qtyApproved=$rs["qtyApproved"];
								}
								
								
							?>
							<tr class="style <?php echo $classRow; ?>" style=" white-space:nowrap;">
				               	<td style="text-align: center;"><?php echo $i; ?></td>
								<td>
									<?php echo $rs["proCode"]." - ".$rs["proName"];?>
									
								</td>
								<td align="center"><?php echo $rs["categoryTitle"];?></td>
								<td align="center"><?php echo $rs["qtyRequest"];?></td>
								<td align="center"><?php echo $qtyApproved;?></td>
								<td align="center"><?php echo $rs["measureTitle"];?></td>
								<td align="center"><?php echo date("d-M-Y",strtotime($rs["dateReqStockIn"]));?></td>
								<td style="font-size: 10px;"><?php echo $rs["note"];?></td>
							</tr>
							<?php 
								}
							?>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="3" >
						<br />
						<table width="40%" border="1"  cellspacing="0" cellpadding="0">
							<tr>
								<td style="vertical-align: top;padding: 2px 5px;height: 80px; line-height: 16px;">
									<span style="font-weight: 600; display: block;text-decoration: underline;"><?php echo $tr->translate("NOTE");?> ៖</span>
									<span style="display: block; font-size:11px;"><?php echo $this->row["note"];?><span>
								</td>
							</tr>
						</table>
						<br />
						<table width="100%" cellspacing="0" cellpadding="0">
							<tr>
								<td style="width:25%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;"><?php echo $tr->translate("REQUEST_BY");?> </span>
								</td>
								<td style="width:25%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;"><?php echo $tr->translate("CHECKING_BY");?> </span>
								</td>
								<td style="width:25%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;"><?php echo $tr->translate("PCHECKING_BY");?> </span>
								</td>
								<td style="width:25%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;"><?php echo $tr->translate("APPROVED_BY");?> </span>
								</td>
							</tr>
							<tr>
								<td colspan="3" style="height:80px;" >
									&nbsp;
								</td>
							</tr>
							<tr>
								<td style="text-align:center;">
									<span style="font-weight: 600; display: block; line-height: 16px;"><?php echo $this->row["user_name"];?></span>
									<span style=" display: block; line-height: 16px;">ថ្ងៃទី<?php echo $dbparmeter->getNumberInkhmer(date("d",strtotime($this->row["date"])));?> ខែ<?php echo $month[date("m",strtotime($this->row["date"]))];?> ឆ្នាំ <?php echo $dbparmeter->getNumberInkhmer(date("Y",strtotime($this->row["date"])));?></span>
								</td>
								<td style="text-align:center;">
									<?php  if(!empty($this->row["checkingBy"])){?>
									<span style="font-weight: 600; display: block; line-height: 16px;"><?php  echo $this->row["checkingByName"];?></span>
									<span style=" display: block; line-height: 16px;">ថ្ងៃទី<?php echo $dbparmeter->getNumberInkhmer(date("d",strtotime($this->row["checkingDate"])));?> ខែ<?php echo $month[date("m",strtotime($this->row["checkingDate"]))];?> ឆ្នាំ <?php echo $dbparmeter->getNumberInkhmer(date("Y",strtotime($this->row["checkingDate"])));?></span>
									<?php }else{?>
										<span style="font-weight: 600; display: block; line-height: 18px;">__________________________</span>
										<span style=" display: block; line-height: 16px;">ថ្ងៃទី____ខែ______ ឆ្នាំ ______</span>
									<?php }?>
								</td>
								<td style="text-align:center;">
									<?php  if(!empty($this->row["pCheckingBy"])){?>
									<span style="font-weight: 600; display: block; line-height: 16px;"><?php  echo $this->row["pCheckingByName"];?></span>
									<span style=" display: block; line-height: 16px;">ថ្ងៃទី<?php echo $dbparmeter->getNumberInkhmer(date("d",strtotime($this->row["pCheckingDate"])));?> ខែ<?php echo $month[date("m",strtotime($this->row["pCheckingDate"]))];?> ឆ្នាំ <?php echo $dbparmeter->getNumberInkhmer(date("Y",strtotime($this->row["pCheckingDate"])));?></span>
									<?php }else{?>
										<span style="font-weight: 600; display: block; line-height: 18px;">__________________________</span>
										<span style=" display: block; line-height: 16px;">ថ្ងៃទី____ខែ______ ឆ្នាំ ______</span>
									<?php }?>
								</td>
								<td style="text-align:center;">
									<?php  if(!empty($this->row["approveBy"])){?>
									<span style="font-weight: 600; display: block; line-height: 16px;"><?php  echo $this->row["approveByName"];?></span>
									<span style=" display: block; line-height: 16px;">ថ្ងៃទី<?php echo $dbparmeter->getNumberInkhmer(date("d",strtotime($this->row["approveDate"])));?> ខែ<?php echo $month[date("m",strtotime($this->row["approveDate"]))];?> ឆ្នាំ <?php echo $dbparmeter->getNumberInkhmer(date("Y",strtotime($this->row["approveDate"])));?></span>
									<?php }else{?>
										<span style="font-weight: 600; display: block; line-height: 18px;">__________________________</span>
										<span style=" display: block; line-height: 16px;">ថ្ងៃទី____ខែ______ ឆ្នាំ ______</span>
									<?php }?>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</div>
	</div>
</div>
<script>
require(["dojo/ready"], function(ready){
	ready(function(){
		 getBranchInfo();
	});
});
		
function getBranchInfo(){
	var url_submit = '<?php echo $this->url(array('module'=>'loan','controller'=>'ilpayment','action'=>'getbranch')); ?>';
	branch_id = '<?php echo empty($this->row['projectId'])?0:$this->row['projectId'];?>';
	if(branch_id=="" || branch_id<=0){
		return false;
	}
	dojo.xhrPost({
	    url: url_submit,	
	    content:{ 
		    'branch_id':branch_id
		},	
		load: function(data) {
			var arr = JSON.parse(data);
			var imagesUrl = '<img  style="height:85px; max-width: 100%;" src="'+arr.url_logo+'" />';
			document.getElementById('projectlogo').innerHTML = imagesUrl;	
			document.getElementById('projectName').innerHTML = 'គម្រោង៖ '+arr.project_name;
		},
		error: function(e) {
		}
	});
}
</script>
