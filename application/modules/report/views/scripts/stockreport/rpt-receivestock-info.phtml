<?php
$tr = Application_Form_FrmLanguages::getCurrentlanguage();
$this->headTitle($tr->translate("DELIVERY_NOTE"));
echo $this->headTitle();
$requestUrl = $this->baseUrl() . "/report/stockmg/request-letter/id/";
?>
<div class="reportblog">
	<div class="card-box">
		<div class="col-sm-12 border-botom">
			<div class="col-sm-8 pd-0">
				<h4 class="m-b-0"><i class="fa fa-file-text" aria-hidden="true"></i>
					<?php echo $tr->translate('DELIVERY_NOTE_DETAIL'); ?>
				</h4>
			</div>
			<div class="col-sm-4 text-right">
			</div>
		</div>
	</div>
	<div class="card-box">
		<div id="divPrint">
			<style>
				table.tableTop tr td,
				span {
					font-size: 12px;
					font-family: 'Times New Roman', 'Khmer OS Battambang';
				}

				table.tableTop tr td span.project-name {
					font-size: 12px;
					font-family: "Times New Roman", "Khmer OS Muol Light";
				}

				table tr td {
					padding: 0 2px;
					line-height: 14px;
				}

				table.content-data {
					border-collapse: collapse;
					border: 1px solid #000;
					font-size: 13px;
				}

				table.content-data thead tr.style {
					line-height: 25px;
					font-size: 12px !important;
					padding: 1px 0px;
					white-space: nowrap;
					height: 22px;
					background: #c1d0f3;
					font-weight: 600;
				}

				table.content-data tr.regurlar {
					background: #eee;
				}

				table.content-data tr td {
					padding: 5px 3px;
					border: 1;
					vertical-align: middle;
				}

				table.content-data tr.headRow td {
					border: solid 1px #000;
					padding: 10px 2px;
					vertical-align: middle;
				}

				.content-data tr.headRow td span {
					display: block;
					line-height: 14px;
				}

				.content-data tr.headRow td small {
					display: block;
					line-height: 12px;
					font-size: 10px;
				}

				table.requestInfo {
					width: 100%;
					margin-top: 10px;
				}

				table.requestInfo tr td {
					vertical-align: top;
				}

				table.requestInfo span.lbTitle {
					line-height: 14px;
					float: left;
					vertical-align: top;
					min-width: 20%;
				}

				table.requestInfo span.lbTitle small {
					display: block;
					font-style: italic;
					font-weight: 200;
					line-height: 10px;
				}

				table.requestInfo tr td span {
					line-height: 14px;
					vertical-align: top;
					min-width: 75%;
				}

				td.centerText {
					text-align: center;
				}

				td.rightText {
					text-align: right;
				}

				.bold {
					font-weight: 600;
				}

				span.redColor {
					color: #ff0000;
				}

				tr.style.rejected {
					background: #ffe5e5;
				}

				tr.rowFooter td span {
					font-weight: 600;
					font-size: 12px;
				}

				tr.rowFooter td span.gtotalVal {
					color: #000000;
					display: block;
					width: 100%;
					border-bottom: dashed 1px #959595;
					text-align: right;
				}

				span.gtotalVal.mainTotal {
					font-size: 14px;
				}

				a.colorInherit {
					color: inherit;
					text-decoration: none;
				}

				.signatureImg {
					height: 50px;
					position: relative;
					margin-bottom: -15px;
				}
			</style>

			<table class="tableTop" width="100%">
				<tr>
					<td width="30%" id="projectlogo">
						<br />
						<img style="height:85px; max-width: 100%;" src="">
					</td>
					<td width="40%" valign="top" style=" padding-bottom: 40px;">
					</td>
					<td width="30%" align="right" style="vertical-align:top; position: relative;">
						<span class="project-name" id="projectName"></span>
						<?php echo $this->printByFormat; ?>
					</td>
				</tr>
				<tr>
					<td colspan="3" align="center">
						<span
							style='font-family: "Times New Roman","Khmer OS Muol Light"; display: block;line-height: 14px;'>ប័ណ្ណទទួលទំនិញលម្អិត</span>
						<span
							style='font-family: "Times New Roman","Khmer OS Muol Light";display: block;line-height: 14px;text-transform: uppercase;font-weight: 600;'>Delivery
							Note Detail
						</span>

					</td>
				</tr>
				<tr>
					<td colspan="3" style="position:relative;">
						<table class="requestInfo">
							<tr>
								<?php
								$rs = $this->rsRow;
								?>
								<td width="30%">
									<span class="lbTitle">
										ឈ្មោះអ្នកផ្គត់ផ្គង់ :
										<small>Supplier Name : </small>
									</span>
									<span class="bold redColor">
										<?php echo $rs['supplierName'] ?>
									</span>
								</td>
								<td width="30%">
									<span class="lbTitle">
										លេខសំណើ :
										<small>Request N<sup>o</sup> : </small>
									</span>
									<span class="bold redColor"><a class="colorInherit" target="_blank"
											href="<?php echo $requestUrl . $rs["requestId"]; ?>"><?php echo $rs["requestNo"]; ?></a>
									</span>
								</td>
								<td width="30%">
									<span class="lbTitle">
										គម្រោង :
										<small>Project Name : </small>
									</span>
									<span class="bold ">
										<?php echo $rs['projectName'] ?>
									</span>

								</td>
							</tr>
							<tr>
								<td>
									<span class="lbTitle">
										អ្នកប្រគល់ទំនិញ :
										<small>Giver : </small>
									</span>
									<span class="bold">
										<?php echo $rs['driverName'] ?>
									</span>
								</td>
								<td>
									<span class="lbTitle">
										អ្នករាប់ទំនិញ :
										<small>Counter : </small>
									</span>
									<span class="bold">
										<?php echo $rs['staffCounter'] ?>
									</span>
								</td>
								<td>
									<span class="lbTitle">
										ប្រភេទឯកសាទទួល :
										<small>Document Type : </small>
									</span>
									<span class="bold">
										<?php echo $rs['dnType'] ?>
									</span>
								</td>
							</tr>
							<tr>
								<td>
									<span class="lbTitle">
										ស្លាកលេខឡាន:
										<small>Plate No. : </small>
									</span>
									<span class="bold">
										<?php echo $rs['plateNo'] ?>
									</span>
								</td>
								<td>
									<span class="lbTitle">
										<?php echo $tr->translate("PICTURE_GOODS"); ?> :
										<small>Goods Picture : <span>
												<?php if (!empty($rs['photoDn'])) { ?><a target="_blank"
														href="<?php echo $this->baseUrl() . "/images/dndocument/" . $rs['photoDn']; ?>">Download</a>
												<?php } else {
													echo "N/A";
												}
												; ?>
											</span></small>
									</span>
								</td>
								<td>
									<span class="lbTitle">
										<?php echo $tr->translate("FILE_DN"); ?> :
										<small>DN File. : <span>
												<?php if (!empty($rs['fileDn'])) { ?><a target="_blank"
														href="<?php echo $this->baseUrl() . "/images/dndocument/" . $rs['fileDn']; ?>">Download</a>
												<?php } else {
													echo "N/A";
												}
												; ?>
											</span></small>
									</span>
								</td>
							</tr>

						</table>
					</td>
				</tr>
				<tr>
					<td colspan="3">
						<table class="content-data" width="100%" border="1" cellspacing="0" cellpadding="0">
							<thead>
								<tr class="style headRow" align="center">
									<td scope="col" class="center" rowspan="2">
										<span>ល.រ</span>
										<small>N<sup>o</sup></small>
									</td>
									<td scope="col" class="center" colspan="2">
										<span>ព័ត៌មានទំនិញ</span>
										<small>Request Information</small>
									</td>
									<td scope="col" class="center" colspan="3">
										<span>ព័ត៌មានការបញ្ជាទិញ</span>
										<small>Purchase Information</small>
									</td>
									<td scope="col" class="center" colspan="4">
										<span>ព័ត៌មានការទទួលទំនិញ</span>
										<small>Receive Information</small>
									</td>
								</tr>
								<tr class="style headRow" align="center">
									<td scope="col" class="center" style="width:200px;">
										<span>ទំនិញ</span>
										<small>Product</small>
									</td>
									<td scope="col" class="center">
										<span>ឯកតា</span>
										<small>Unit</small>
									</td>

									<td scope="col" class="center">
										<span>បរិមាណបញ្ជាទិញ</span>
										<small>Purchase Qty</small>
									</td>
									<td scope="col" class="center">
										<span>លេខបញ្ជាទិញ</span>
										<small>Purchase N<sup>o</sup></small>
									</td>
									<td scope="col" class="center">
										<span>ថ្ងៃបញ្ជាទិញ</span>
										<small>Purchase Date</small>
									</td>

									<td scope="col" class="center">
										<span>បរិមាណទទួល</span>
										<small>Received Qty</small>
									</td>
									<td scope="col" class="center">
										<span>បរិមាណនៅសល់</span>
										<small>Received Qty</small>
									</td>
									<td scope="col" class="center">
										<span>លេខ ប័ណ្ណទទួល/វិក្កយបត្រ</span>
										<small>DN N<sup>o</sup> / Invoice N<sup>o</sup></small>
									</td>
									<td scope="col" class="center">
										<span>ថ្ងៃទទួលទំនិញ(ទិញ)</span>
										<small>Received Date</small>
									</td>
								</tr>

							</thead>
							<?php
							$i = 0;
							if (!empty($this->dnDetail))
								foreach ($this->dnDetail as $index => $result) {
									$i++;
									?>
									<tr class="style" style=" white-space:nowrap;">
										<td data-label="ល.រ​ /N.o" class="centerText">
											<?php echo $index + 1; ?>
										</td>
										<td data-label="ឈ្មោះទំនិញ/Product Name">
											<?php echo $result['proName'] . " " . $result['proCode']; ?>
										</td>
										<td data-label="ឯកតា/ Unit" class="centerText">
											<?php echo $result['measureLabel'] ?>
										</td>
										<td data-label="បរិមាណទិញ/Purchase Qty" class="centerText">
											<?php echo number_format($result['qtyReceive'] + $result['qtyAfterReceive'], 2); ?>
										</td>
										<td data-label="លេខបញ្ជាទិញ/Purchase No" class="centerText">
											<span class="bold redColor"><a class="colorInherit" target="_blank"
													href="<?php echo $this->baseUrl() . "/report/stockmg/purchase-letter/id/" . $rs["poId"]; ?>"><?php echo $rs["purchaseNo"]; ?></a>
											</span>
										</td>
										<td data-label="ថ្ងៃបញ្ជារទិញ/Purchase Date" class="centerText">
											<span class="bold">
												<?php
												$format = 'd-M-Y';
												$dateString = $rs["purchaseDate"];
												$date = new DateTime($dateString);
												$purchaseDate = $date->format($format);
												echo $purchaseDate;
												?>
											</span>
										</td>
										<td data-label="បរិមាណទទួល/Receive Qty" class="centerText">
											<?php echo number_format($result['qtyReceive'], 2); ?>
										</td>
										<td data-label="បរិមាណនៅសល់/Remaining Qty" style="font-size: 10px;" class="centerText">
											<?php echo number_format($result['qtyAfterReceive'], 2); ?>
										</td>
										<td data-label="សម្គាល់/Note" style="font-size: 10px;" class="centerText">
											<span class="bold redColor">
												<?php echo $rs['dnNumber'] ?>
											</span>
										</td>
										<td data-label="ថ្ងៃទទួទំនិញ/Receive Date" class="centerText">
											<span class="bold">
												<?php
												$format = 'd-M-Y';
												$dateString = $rs["receiveDate"];
												$date = new DateTime($dateString);
												$receiveDate = $date->format($format);
												echo $receiveDate;
												?>
											</span>
										</td>
									</tr>
									<?php
								}
							for ($num = $i; $num < 10; $num++) {
								?>
								<tr class="style" style=" white-space:nowrap;">
									<td class="centerText">
										<?php echo $num + 1; ?>
									</td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
							<?php } ?>
						</table><br />

					</td>
				</tr>

				<tr>
					<td colspan="3">
						<br />


						<div class="clearfix" style="clear: both !important;"></div>
						<table width="100%" cellspacing="0" cellpadding="0" style="margin-top:10px;">
							<tr>
								<td style="width:40%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;">អ្នកប្រគល់ទំនិញ/Deliver</span>
								</td>
								<td style="width:20%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;">អ្នករាប់ទំនិញ/Product Counter</span>
								</td>
								<td style="width:40%; vertical-align: top;line-height: 16px; text-align:center;">
									<span style="font-weight: 600; display: block;">អ្នកផ្ទៀងផ្ទាត់ / Verifier</span>
								</td>
							</tr>
							<tr>
								<td colspan="2" style="height:80px;">
									&nbsp;
								</td>

								<td style="text-align:center;">
									<?php
									if (!empty($rs['verifiedSignature'])) {
										if (file_exists(PUBLIC_PATH . "/images/photo/signature/" . $rs['verifiedSignature'])) {
											$images = $this->baseUrl() . '/images/photo/signature/' . $rs['verifiedSignature'];
											?>
											<img class="signatureImg" src="<?php echo $images; ?>" />
										<?php }
									} else { ?>
										&nbsp;
									<?php } ?>
								</td>
							</tr>
							<tr>
								<td style="text-align:center;">
									<span style="font-weight: 600; display: block; line-height: 16px;">
										<?php echo $rs['driverName'] . "<br />" . $rs['receiveDate']; ?>
									</span>

								</td>
								<td style="text-align:center;">
									<span style="font-weight: 600; display: block; line-height: 16px;">
										<?php echo $rs['staffCounter'] . "<br />" . $rs['receiveDate']; ?>
									</span>

								</td>
								<td style="text-align:center;">
									<span style="font-weight: 600; display: block; line-height: 16px;">
										<?php echo $rs['verifiedBy'] . "<br />" . $rs['verifiedDate']; ?>
									</span>
								</td>
							</tr>
						</table>
						<div class="clearfix" style="clear: both !important;"></div>
					</td>
				</tr>

			</table>
		</div>
	</div>
</div>
<script>
	require(["dojo/ready"], function (ready) {
		ready(function () {
			getBranchInfo();
		});
	});

	function getBranchInfo() {
		var url_submit = '<?php echo $this->url(array('module' => 'loan', 'controller' => 'ilpayment', 'action' => 'getbranch')); ?>';
		branch_id = '<?php echo empty($this->rsRow['projectId']) ? 0 : $this->rsRow['projectId']; ?>';
		if (branch_id == "" || branch_id <= 0) {
			return false;
		}
		dojo.xhrPost({
			url: url_submit,
			content: {
				'branch_id': branch_id
			},
			load: function (data) {
				var arr = JSON.parse(data);
				var imagesUrl = '<img  style="height:65px; max-width: 100%;" src="' + arr.url_logo + '" />';
				document.getElementById('projectlogo').innerHTML = imagesUrl;
				document.getElementById('projectName').innerHTML = 'គម្រោង៖ ' + arr.project_name;
			},
			error: function (e) {
			}
		});
	}
</script>