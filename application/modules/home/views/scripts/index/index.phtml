 <?php
	$tr=Application_Form_FrmLanguages::getCurrentlanguage();
	
	?>
 
 <!--Morris Chart CSS -->
<link rel="stylesheet" href="<?php echo $this->baseUrl()."/"?>dashboard/plugins/morris/morris.css">

 <!-- Bootstrap core CSS -->
 <link href="<?php echo $this->baseUrl()."/"?>dashboard/css/bootstrap.min.css" rel="stylesheet">
<!-- Icons CSS -->
<link href="<?php echo $this->baseUrl()."/"?>dashboard/css/icons.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="<?php echo $this->baseUrl()."/"?>dashboard/css/style.css" rel="stylesheet">
<div id="page-wrapper">
	<!-- Page content start -->
	<div class="page-contentbar">
		<!-- START PAGE CONTENT -->
		<div id="page-right-content">
			<div class="container">
				 <div class="row">
					<div class="col-lg-6">
						<div class="card-box">
							<div class="col-lg-12">
								<div class="accounting-management text-center">
									<div class="col-lg-12 capital-box" style="width: 100%; background: #203864; color: #fff">
										<span data-bind="text: txnRecorded"><?php if ($this->netIncome<0){ echo "$ ".number_format(abs($this->netIncome),2);}else{ echo "$ ".number_format($this->netIncome,2);}?></span>
										<p class="month" style="width: 70%; text-align: center; margin: 0 auto;" data-bind="text: lang.lang.transactions_recorded"><?php echo $tr->translate("Net Income")?></p>
									</div>
									<div class="col-lg-12" style="padding: 0;">
										<div class="col-lg-6 capital-box" style="background: #0077c5;">
											<span data-bind="text: currentRatio"><?php echo "$ ".number_format($this->totalIncome,2);?></span> 
											<p class="month" data-bind="text: lang.lang.current_ratio"><?php echo $tr->translate("Total Income")?></p>
										</div>
										<div class="col-lg-6 capital-box" style="background: #21abf6; color: #fff;">
											<span data-bind="text: quickRatio"><?php echo "$ ".number_format($this->totalExpense,2);?></span> 
											<p class="month" style="color: #fff;" data-bind="text: lang.lang.quick_ratio"><?php echo $tr->translate("Total Expense")?></p>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="card-box">
                        	<div class="col-sm-12">
                            	 <p class="m-t-0"><?php echo $tr->translate("Customer Nearly Payment")?></p>
                                <div class="table-responsive dashboard">
                                     <table class="table table-hover mails m-0 table table-actions-bar">
                        	              <thead>
                                              <tr>
                                                  <th><?php echo $tr->translate("NUM")?></th>
                                                  <th><?php echo $tr->translate("CUSTOMER_NAME")?></th>
                                                  <th><?php echo $tr->translate("TEL")?></th>
                                                  <th><?php echo $tr->translate("PROPERTY_NAME")?></th>
                                                  <th><?php echo $tr->translate("BALANCE")?></th>
                                                  <th><?php echo $tr->translate("DATE_PAYMENT")?></th>
                                                  <th><?php echo $tr->translate("AMOUNT_LATE")?></th>
                                                  <th><?php echo $tr->translate("AMOUNT_COLLECT")?></th>
                                                  <th><?php echo $tr->translate("PAYMENT")?></th>
                                              </tr>
                                          </thead>
                                            <tbody>
                                            	<?php if (!empty($this->customerNearlyPayment)) foreach ($this->customerNearlyPayment as $key=> $result){
                                            	
                                            		$url = $this->url(array('module'=>'loan','controller'=>'ilpayment','action'=>'add'), null, true)."/id/".$result['sale_id'];
                                            		?>
                                                <tr>
                                                    <td align="center"><?php echo $key+1;?></td>
													<td style="white-space: nowrap;"><a href="<?php echo $url;?>"><?php echo $result['client_name'];?></a></td>
													<td class="numeric"><a class="text-muted" href="<?php echo $url;?>"><?php echo $result['phone_number'];?></a></td>
													<td class="numeric"><a class="text-muted" href="<?php echo $url;?>"><?php echo $result['land_address'].' '.$result['street'];?></a></td>
													<?php  $total_payment = $result['principal_permonthafter']+$result['total_interest_after']+$result['service_charge'];?>
													<td class="numeric"><a class="text-muted" href="<?php echo $url;?>"><?php echo number_format($result['begining_balance_after'],2);?></a></td>
													<td class="numeric"><a class="text-muted" href="<?php echo $url;?>"><?php echo date("d/m/Y",strtotime($result['date_payment']));?></a></td>
													<?php 
													$end_dat=date("Y-m-d");
													$total_day=strtotime($end_dat)-strtotime($result['date_payment']);
													$total_late_day=$total_day/(60*60*24);
												    ?>
													<td class="numeric"><a href="<?php echo $url;?>" style='color:red;'><?php echo $total_late_day."ថ្ងៃ";//@abs($interval->format('%R%a'))."ថ្ងៃ"; ?></a></td>
													<td class="numeric" align="center"><a href="<?php echo $url;?>"><?php echo $result['no_installment'];?></a></td>
													<td class="numeric"><a href="<?php echo $url;?>"><?php echo number_format($total_payment,2);?></a></td>
                                                </tr>
												<?php }?>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                         </div>    
					</div> <!-- end col -->	  
					 <div class="col-lg-6">
						<div class="card-box">
							<div class="col-lg-12">
								<div class="col-lg-6">
									<p><span data-bind="text: lang.lang.performance"><?php echo $tr->translate("Property Infomation")?></span></p>
									<table class="performance">
										<tbody>
											<tr>
												<td><span data-bind="text: lang.lang.income"><?php echo $tr->translate("All Property")?></span></td>
												<td></td>
												<td align="right"><span data-bind="text: obj.income"><?php echo $this->allProperty;?></span></td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.expense"><?php echo $tr->translate("Property Sold")?></span></td>
												<td></td>
												<td align="right"><span data-bind="text: obj.expense"><?php echo $this->propertySold;?></span></td>
											</tr>
											<tr>
												<td><b><span data-bind="text: lang.lang.net_income"><?php echo $tr->translate("Property Available")?></span></b></td>
												<td></td>
												<td align="right"><b data-bind="text: obj.net_income"><?php echo $this->availableProperty;?></b></td>
											</tr>
										</tbody>
									</table>
								</div>
								<div class="col-lg-6">
									<p><span data-bind="text: lang.lang.performance"><?php echo $tr->translate("Customer / Agency Infomation")?></span></p>
									<table class="performance">
										<tbody>
											<tr>
												<td><span data-bind="text: lang.lang.income"><?php echo $tr->translate("Customers")?></span></td>
												<td></td>
												<td align="right"><span data-bind="text: obj.income"><?php echo $this->AllClient;?></span></td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.expense"><?php echo $tr->translate("Agency")?></span></td>
												<td></td>
												<td align="right"><span data-bind="text: obj.expense"><?php echo $this->CountAllAgency;?></span></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="col-lg-12">
								<div class="col-lg-12">
									<p><span data-bind="text: lang.lang.performance"><?php echo $tr->translate("Sale Information")?></span></p>
									<div class="widget-body alert-info welcome-nopadding">
											<table width="100%" class="saleInfo">
												<thead>
													<tr align="center">
														<td>										
															&nbsp;
														</td>
														<td>
															<span data-bind="text: obj.ar_customer"><?php echo $tr->translate("Number Of Sale")?></span>
														</td>
														<td>
															<span data-bind="text: obj.ar_overdue"><?php echo $tr->translate("Sale Income")?></span>
														</td>
													</tr>
												</thead>
												<tbody>
													<tr align="left">
														<td class="border-rig">										
															<span data-bind="text: obj.ar_open"><?php echo $tr->translate("Total Sale")?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_customer"><?php echo $this->CountAllSale['total'];?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_overdue"><?php echo "$ ".number_format($this->CountAllSale['totalAmount'],2);?></span>
														</td>
													</tr>
													<tr align="left">
														<td class="border-rig">										
															<span data-bind="text: obj.ar_open"><?php echo $tr->translate("Completed Sale")?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_customer"><?php echo $this->CountCompletedSale['total'];?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_overdue"><?php echo "$ ".number_format($this->CountCompletedSale['totalAmount'],2);?></span>
														</td>
													</tr>
													<tr align="left">
														<td class="border-rig">										
															<span data-bind="text: obj.ar_open"><?php echo $tr->translate("Canceled Sale")?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_customer"><?php echo $this->CountCanceledSale;?></span>
														</td>
														<td align="center">
															<span data-bind="text: obj.ar_overdue"><?php echo "$ ".number_format($this->CancelPropertyAmount,2);?></span>
														</td>
													</tr>
												</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div class="card-box">
								<div class="col-lg-12">
								<h4 class="m-t-0">Total Revenue</h4>
								<div class="text-center">
									<ul class="list-inline chart-detail-list">
										<li>
											<h5 class="font-normal"><i class="fa fa-circle m-r-10 text-primary"></i>Series A</h5>
										</li>
										<li>
											<h5 class="font-normal"><i class="fa fa-circle m-r-10 text-muted"></i>Series B</h5>
										</li>
									</ul>
								</div>
								<div id="dashboard-bar-stacked" style="height: 200px;"></div>
							</div>
						</div> 
					</div> <!-- end col -->	  
				</div> <!-- end row -->
				
                 <div class="row-fluid">
					<div style="margin-top: 10px; margin-left: 0;" align="center">
						<p>© 2018<span data-bind="text: lang.lang.all_rights_reserved"><a href="http://www.cam-app.com" target="_blank" > Cam App Teachnology</a>. All rights reserved.</span></p>
					</div>	
				</div>       
			</div>
		</div>
		<!-- END PAGE CONTENT -->
	</div>

</div>
   <!-- js placed at the end of the document so the pages load faster -->
        <script src="<?php echo $this->baseUrl()."/"?>dashboard/js/jquery-2.1.4.min.js"></script>
        <script src="<?php echo $this->baseUrl()."/"?>dashboard/js/bootstrap.min.js"></script>


<!--Morris Chart-->
<script src="<?php echo $this->baseUrl()."/"?>dashboard/plugins/morris/morris.min.js"></script>
<script src="<?php echo $this->baseUrl()."/"?>dashboard/plugins/raphael/raphael-min.js"></script>

 <!-- Dashboard init -->
<script src="<?php echo $this->baseUrl()."/"?>dashboard/pages/jquery.dashboard.js"></script>

 <!-- App Js -->
        <script src="<?php echo $this->baseUrl()."/"?>dashboard/js/jquery.app.js"></script>

