<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$frm = $this->frm_income;	
?>
<script src="<?php echo $this->baseUrl();?>/js/help.js"></script>
<title><?php echo $tr->translate("ADD_OTHER_INCOME")?></title>
<style>	
.fullside {
	width: 100%;
	height: 30px;
}
</style>
 <div class="card">
	<div class="card-content collapse show">
	
			<div class="card-box">
	             <div class="col-sm-12 border-botom">
			    	<div class="col-sm-8 pd-0">
			    		<h4 class="m-b-0"><i class="fa fa-money" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('ADD_OTHER_INCOME');?></h4>
	    			</div>
	    			<div class="col-sm-4 text-right">
	    			</div>
	    		</div>
	    	</div>

		<form action="" dojoType="dijit.form.Form" method="post" enctype="multipart/form-data">
		
			<script type="dojo/method" event="onSubmit">   
				if(this.validate()) {			
					branch=dijit.byId('branch_id').get('value');
					if(branch==-1 || branch==0){
						alert('<?php echo $tr->translate('PLEASE_SELECT_BRANCH');?>!');
						dijit.byId('branch_id').focus();
						return false;
					}		
					cateIncome=dijit.byId('cateIncome').get('value');
					if(cateIncome==0 || cateIncome=='' || cateIncome==-1){
						alert('<?php echo $tr->translate('PLEASE_SELECT_CATEGORY');?>!');
						dijit.byId('cateIncome').focus();
						return false;
					}
					loadingBlock();
					return true;
				}else {
					return false;
				}
			</script>
				
	    	<div class="card-box">
				
	        	<div class="col-md-5 col-sm-5 col-xs-12">
					<div class="card-blogform">
							<div class="card-body"> 
								<div class="row"> 
									<div class="col-md-12 col-sm-12 col-xs-12">

										<div class="d-flex "> 
											<div class="settings-main-icon ">
												<i class="material-icons-outlined">local_atm</i>
												
											</div> 
											<div class="col-md-10 col-sm-10 col-xs-12"> 
												<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("INCOME_INFO");?></p>
											</div> 
										</div>

										<div class="form-group">
											<label class="control-label bold col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("BRANCH_NAME");?> 
											</label>
											<div class="col-md-7 col-sm-7 col-xs-12">
												<?php echo $frm->getElement("branch_id");?>
											</div>
										</div>

										<div class="form-group">
											<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("PAYMENT_NO");?> </label>
											<div class="col-md-7 col-sm-7 col-xs-12">
												<?php echo $frm->getElement("paymentNo");?>
											</div>
										 </div>
										 <div class="form-group">
											<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("INCOME_CATEGORY");?> </label>
											<div class="col-md-4 col-sm-4 col-xs-12">
												<?php echo $frm->getElement("cateIncome");?>
											</div>
											<div class="col-md-3 col-sm-3 col-xs-12">
												<input type="button" class="button-class button-primary" iconClass="glyphicon glyphicon-refresh" dojoType="dijit.form.Button" onclick="getRefreshData();" label="<?php echo $tr->translate("GET_DATA");?>"  />
											</div>
										</div>

										<div class="form-group">
											<label class="control-label bold col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("INCOME_TITLE");?> 
											</label>
											<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("incomeTitle");?>
											</div>
										</div>
										<div class="form-group">
											<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("DATE");?> </label>
											<div class="col-md-7 col-sm-7 col-xs-12">
												<?php echo $frm->getElement("paymentDate");?>
											</div>
										 </div>
									</div>
								</div>
							</div>
						</div>
	            </div>
	            <div class="col-md-5 col-sm-5 col-xs-12">
					<div class="card-blogform">
							<div class="card-body"> 
								<div class="row"> 
									<div class="col-md-12 col-sm-12 col-xs-12">
											<div class="d-flex "> 
												<div class="settings-main-icon ">
													<i class="material-icons-outlined">payments</i>
												</div> 
												<div class="col-md-10 col-sm-10 col-xs-12"> 
													<p class="tx-20 font-weight-semibold d-flex "><?php echo $tr->translate("PAYMENT_INFO");?></p>
												</div> 
											</div>
											<div class="form-group">
												<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("PAYMENT_METHOD");?> </label>
												<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("paymentMethod");?>
												</div>
											 </div>
											 <div class="form-group">
												<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("BANK");?> </label>
												<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("bankId");?>
												</div>
											 </div>
											 <div class="form-group">
												<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("ACCOUNT_AND_CHEQUE_NO");?> </label>
												<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("accNameAndChequeNo");?>
												</div>
											 </div>
											 <div class="form-group">
												<label class="control-label bold col-md-5 col-sm-5 col-xs-12"><?php echo $tr->translate("PAID_AMOUNT");?> </label>
												<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("totalAmount");?>
												</div>
											 </div>
											<div class="form-group">
												<label class="control-label col-md-5 col-sm-5 col-xs-12" ><?php echo $tr->translate("NOTE");?> :
												</label>
												<div class="col-md-7 col-sm-7 col-xs-12">
													<?php echo $frm->getElement("note");?>					
												</div>
											</div>
									</div>
								</div>
							</div>
						</div>
	            </div>
			
	       </div>
			
	       <div class="card-box">
               	<div class="col-md-10 col-sm-10 col-xs-12 border-top mt-20 ptb-10 text-center">
				  	 <input type="submit" class="button-class button-primary" iconClass="glyphicon glyphicon-floppy-remove" value="save_close" id="save_close" name="save_close" label="<?php echo $tr->translate("SAVE_CLOSE");?>" dojoType="dijit.form.Button"  />
					<input type="submit" class="button-class button-primary" iconClass="glyphicon glyphicon-floppy-disk" value="save_close" id="save_new" name="save_new" label="<?php echo $tr->translate("SAVENEW");?>" dojoType="dijit.form.Button" />
	    		</div>
	    	</div>
		</form>
	</div>
</div>
<script src="<?php echo $this->baseUrl();?>/admin/js/global.js"  type="text/javascript"></script>
<script type="text/javascript">

	dojo.require("dijit.form.Form");
	dojo.require("dojo.data.ItemFileWriteStore");  
	dojo.require("dojo.NodeList-manipulate");
	dojo.require("dijit.form.Button");
    dojo.require("dijit.form.Textarea");
    dojo.require("dijit.form.NumberTextBox");
    dojo.require("dijit.form.DateTextBox");



	require(["dojo/ready"], function(ready){
		ready(function(){
			
			onChageFunctionByBranch();
		});

		
	 });


	function onChageFunctionByBranch(){
	//	enablePayment();
		getPaymentNoByBranch();

	}

	function addNewCategory(){
		cateId = dijit.byId('cateIncome').get('value');
		if(cateId==-1){
			window.open('<?php echo $this->baseUrl();?>/po/cateincome/add?isAddCateIncome=1');
			dijit.byId('cateIncome').reset();
		}
	}
	var urlGetAllCateIncome = '<?php echo $this->url(array('module'=>'po','controller'=>'cateincome','action'=>'getallcateincome')); ?>';
	function getRefreshData(){
			
		dojo.xhrPost({
			url:urlGetAllCateIncome,	
			handleAs:"json",
			load: function(data) {
				supplierStore  = getDataStorefromJSON('id','name', data);	
			    dijit.byId('cateIncome').set('store',supplierStore);
				
				
			},
			error: function(err){
			}
		});
		
	}

	function enablePayment(){
		paymentMethod = dijit.byId('paymentMethod').get('value');
		dijit.byId("bankId").set("readOnly",false);
		dijit.byId("bankId").reset();
		dijit.byId("accNameAndChequeNo").set("readOnly",false);
		dijit.byId("accNameAndChequeNo").attr("value",'');
		if(paymentMethod==1){
			dijit.byId("bankId").set("readOnly",true);
			dijit.byId("accNameAndChequeNo").attr("value",'N/A');
			dijit.byId("accNameAndChequeNo").set("readOnly",true);
		}else{
			dijit.byId("accNameAndChequeNo").set("readOnly",false);
			
		}
	}

	var urlGetPaymentNo = '<?php echo $this->url(array('module'=>'invpayment','controller'=>'payment','action'=>'getpaymentno')); ?>';
	function getPaymentNoByBranch(){
		
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id=='' || branch_id<=0){
			return false;
		}
		paymentDate = dijit.byId('paymentDate').get('value');
		if(paymentDate==''){
			infoMessageAlert('<?php echo $tr->translate('PLEASE_SELECT_DATE');?>');
			dijit.byId('paymentDate').focus();
			return false;
		}
			var a = new Date(paymentDate);
			mm = a.getMonth()+1;
			var dd = a.getDate();
			 if(dd<10){
				 dd = "0"+dd;
			}
			//month = returnMOnth(mm);
			month=mm;
			if(mm<10){
				 month = "0"+mm;
			}
			
			var y = a.getFullYear();
			var paymentDate = dd +'-'+month+'-'+y ;
	
		dojo.xhrPost({
			url:urlGetPaymentNo,	
			content:{ 
				'branch_id':branch_id,'paymentDate':paymentDate
			},		    
			handleAs:"json",
			load: function(data) {
				dijit.byId('paymentNo').set('value', data);
			},
			error: function(err) {
			}
		});
	} 	

/*
	var url_get_recceipt_number = "<?php echo $this->url(array('module'=>'registrar','controller'=>'income','action'=>'get-receipt-number')); ?>";
	function getReceiptNumber(condition){
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id=="" || branch_id==-1){
			dijit.byId('invoice').attr('value','');
			return false;
		}lbl_for_date
		dojo.xhrPost({
			url:url_get_recceipt_number,
			content:{
				'branch_id':branch_id
				},
			handleAs:"json",
			load: function(data) {
				 dijit.byId('invoice').attr('value',data);
				 if(condition!=''){
					 printReceipt(data);
				 }
			},
			error: function(err) {
			}
		});
	}

	var url_add_cate_income = '<?php echo $this->url(array("module"=>"registrar","controller"=>"income","action"=>"add-cate-income")); ?>';
	function addCateIncome(){
		if(dijit.byId('frm_add_cate_income').validate()) {
			dijit.byId('save_ajax').set('disabled',true);
			dojo.xhrPost({
				url:url_add_cate_income,
				form: dojo.byId("frm_add_cate_income"),
				handleAs:"json",
				load: function(data) {
					var Itemmake = { 
							id: data,
							name: dijit.byId('cate_title').get('value')
						};
					addDataToSelectbox(dijit.byId('cate_income'), cate_income_store, Itemmake, data);
					dijit.byId('frm_add_cate_income').reset();
					hidePopup();
				},
				error: function(err) {
				}
			});
		}
	}
	function hidePopup(){		
		dijit.byId("popup_cate").hide();
		dijit.byId('save_ajax').set('disabled',false);
	}
	function setReadonlyCheqe(){
		payment_method = dijit.byId('payment_method').get('value');
		if(payment_method == 3){
			dijit.byId("cheqe_no").set('readOnly',false);
		}else{
			dijit.byId('cheqe_no').attr('value','');
			dijit.byId("cheqe_no").set('readOnly',true);
		}
	}
	function printReceipt(new_receipt){
		if(dijit.byId('frm_add_tran').validate()) {
			branch = dijit.byId('branch_id').get('value')
			if(branch=='' || branch==0){
				alert('<?php echo $tr->translate('PLEASE_SELECT_BRANCH');?>!');
				dijit.byId('branch_id').focus();
				return false;
			}
			cate_income = dijit.byId('cate_income').get('value')
			if(cate_income==0 || cate_income==-1){
				alert('<?php echo $tr->translate('PLEASE_SELECT_CATEGORY');?>!');
				dijit.byId('cate_income').focus();
				return false;
			}
			payment_method = dijit.byId('payment_method').get('value')
			if(payment_method==-1){
				alert('<?php echo $tr->translate('Please select payment method');?>!');
				dijit.byId('payment_method').focus();
				return false;
			}
			
			if(new_receipt==''){
				getReceiptNumber(1);
			}else{
				dojo.byId("receipt_no").innerHTML = new_receipt;
			}
			symbal="$ ";
			
			 dojo.byId("lbl_for_date").innerHTML  = dijit.byId("date").attr('displayedValue');
			
			dojo.byId("lbl_title_income").innerHTML = dijit.byId("title").get('value');
			if(cate_income==0){
				dojo.byId("lbl_cate_income").innerHTML = "";
			}else{
				dojo.byId("lbl_cate_income").innerHTML = dijit.byId("cate_income").attr('displayedValue');
			}
			if(payment_method==-1){
				dojo.byId("lbl_payment_method").innerHTML = "";
			}else{
				dojo.byId("lbl_payment_method").innerHTML = dijit.byId("payment_method").attr('displayedValue');
			}
			dojo.byId("lbl_branch").innerHTML = dijit.byId("branch_id").attr('displayedValue');
			dojo.byId("lbl_student").innerHTML = dijit.byId("studentId").attr('displayedValue');
			dojo.byId("lbl_bank").innerHTML = dijit.byId("bank_name").attr('displayedValue');
			dojo.byId("lbl_total_amount").innerHTML = symbal+dijit.byId("total_income").get('value').toFixed(2);
			dojo.byId("lbl_cheqe_no").innerHTML = dijit.byId("cheqe_no").get('value');
			dojo.byId("lbl_description").innerHTML = dijit.byId("note").get('value');
			
			dijit.byId("terms").show();	
		}
	}
	function cloneReceipt(){
		loadingBlock();
		setTimeout(function () {
			 <?php if($this->data['receipt_print']>1){?>
			 dojo.byId('printblog2').innerHTML = dojo.byId('divPrint1').innerHTML;
			 <?php }?>
	        HideloadingBlock();
	    }, 500);
	}
	function printSubmit(){
		window.frames["print_frame"].document.body.innerHTML = dojo.byId('PrintReceipt').innerHTML;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	    dijit.byId('frm_add_tran').submit();
	}
	function hideDialog(){
		dijit.byId('terms').hide();
	}

function submitDataAddNew(){
		if(dijit.byId('frm_add_tran').validate()) {
			dijit.byId('savenew').set('disabled',true);
			
			var url_submit = '<?php echo $this->url(array('module'=>'registrar','controller'=>'income','action'=>'add')); ?>';
			loading();
			dojo.xhrPost({
				url: url_submit,	
				form: dojo.byId("frm_add_tran"),		    
				load: function(data) {
					document.getElementsByClassName("overlay")[0].style.display="none";		
					alert('<?php echo $tr->translate('INSERT_SUCCESS');?> !');
					window.location.href ="<?php echo $this->baseUrl();?>/registrar/income/add";
				},
				error: function(e) {
				}
			});
		}
	}
	function loading(){
		document.getElementsByClassName("overlay")[0].style.display="block";
	}

	*/
</script>


