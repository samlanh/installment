<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	echo $this->headTitle($tr->translate('COMISSION_STAFF'));
	$frm = $this->frm_loan;
?>
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>
<script>
	dojo.require("dojo.data.ItemFileWriteStore");  
	dojo.require("dijit.form.DateTextBox");
	dojo.require("dijit.form.NumberTextBox");
	dojo.require("dijit.form.Textarea");
	dojo.require("dijit.Dialog");
</script>
<?php $rs = $this->row;?>
<div class="card">
	<div class="card-content collapse show">
		<form id="add_cancel" action="" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
			 <script type="dojo/method" event="onSubmit">			
				if(this.validate()) {
					loadingBlock();
    				return true;
   				}else {
    				return false;
   				}
			</script>
			<div class="card-box">
               	<div class="col-sm-12 border-botom">
		    		<div class="col-sm-8 pd-0">
		    			<h4 class="m-b-0"><i class="fa fa-edit" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<?php echo $tr->translate('REPORT_COMISSION_STAFF');?></h4>
	    			</div>
	    			<div class="col-sm-4 text-right">
	    			</div>
	    		</div>
	    	</div>
	    	<div class="card-box">
	    		<div class="col-md-4 col-sm-4 col-xs-12">
					<div class="form-group">
	                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" for="first-name"><i class="fa fa-hand-o-right" aria-hidden="true"></i> <?php echo $tr->translate("CLIENT_INFO");?> 
	                   </label>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("BRANCH_NAME");?> <span class="required">*</span> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('branch_id');?><?php echo $frm->getElement('id')?>
	                    	<input type="hidden" id="invoice_no" name="invoice_no" value="<?php echo $this->row['invoice'];?>" dojoType="dijit.form.TextBox"/>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("PROPERTY_CODE");?> <span class="required">*</span> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<input id="sale_client" />
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("SALE_NO");?> <span class="required">*</span> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<input id="sale_no" ><?php echo $frm->getElement('property_id')?>
	                   </div>
	                </div>
	             </div>
	             <div class="col-md-4 col-sm-4 col-xs-12">
					<div class="form-group">
	                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" for="first-name"><i class="fa fa-hand-o-right" aria-hidden="true"></i> <?php echo $tr->translate("INFO_INDILOAN");?> 
	                   </label>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("SOLD_PRICE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('price_sold');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("DISCOUNT");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('discount');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("PAYMENT_TYPE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('schedule_opt');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("INSTALLMENT_PAID");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('installment_paid');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("PAID_AMOUNT");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('paid_amount');?>
	                   </div>
	                </div>
	                 <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("BALANCE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('balance');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("COMISSION_EXPECTED");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php  echo $frm->getElement('full_commission');?>
	                   </div>
	                </div>
	                 <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("COMMISSION");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('commision');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("COMISSION_BALANCE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	 <input readOnly="readOnly" value="0" dojoType="dijit.form.NumberTextBox" class="fullside" id="commision_balance" name="commision_balance" value="" type="text">
	                   </div>
	                </div>
	             </div>
	             <div class="col-md-4 col-sm-4 col-xs-12">
					<div class="form-group">
	                   <label class="control-label col-md-12 col-sm-12 col-xs-12 title-blog bold" for="first-name"><i class="fa fa-money" aria-hidden="true"></i> <?php echo $tr->translate("PAYMENT_TYPE");?> 
	                   </label>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("STAFF_NAME");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<input id="staff_id" />
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("PAYMENT_TYPE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('payment_type');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("CHEQUE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('cheque');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("CHEQUE_ISSUER");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('cheque_issuer');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("COMMISSION");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('return_back');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("CATEGORY");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<input id="income_category" />
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("DATE");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('date');?>
	                   </div>
	                </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("NOTE");?> :
	                   </label>
	                  
	                </div>
	                 <div class="form-group">
	                  <div class="col-md-12 col-sm-12 col-xs-12">
	                    	<input style=" min-height: 60px;" dojoType="dijit.form.Textarea" class="fullside" id="note" name="note" value="<?php echo $rs['description'];?>" type="text">
	                   </div>
	                 </div>
	                <div class="form-group">
	                   <label class="control-label col-md-5 col-sm-5 col-xs-12" for="first-name"><?php echo $tr->translate("STATUS");?> :
	                   </label>
	                   <div class="col-md-7 col-sm-7 col-xs-12">
	                    	<?php echo $frm->getElement('status');?>
	                   </div>
	                </div>
	             </div>
	        </div>
	    	
	      	<div class="clearfix"></div>
			 <div class="card-box">
             	<div class="col-sm-12 border-top mt-20 ptb-10 text-center">
 				<input type="submit" name="save_close"​​ value="រក្សាទុក​  + ចាកចេញ" label="<?php echo $tr->translate('SAVECLOSE')?>" id="submitBtn" dojoType="dijit.form.Button"
 					iconClass="dijitEditorIcon dijitEditorIconSave"/>
 				<input type="button" label="<?php echo $tr->translate("PREVIEW")?>" name='print' value=''print'' dojoType="dijit.form.Button"
 					iconClass="dijitIconNewTask" onClick="printSave('');displayNone();" />
    			</div>
    		</div>
		</form>
	</div>
</div>
<div class="dijitHidden">
	<div data-dojo-type="dijit.Dialog" style="width:30%;" id="popup_category" >
		<form style="background-color: buttonface; width:100%;" id='frm_category' dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
			<table cellspacing="10" width="100%" style="margin: 0 auto;">
				<tr>
					<td>
						<fieldset style="background-color: buttonface;">
						<legend align="center" ><?php echo $tr->translate('ADD_CATEGORY');?></legend>
							<table style="margin: 0 auto; width: 100%;  padding:10px;" cellspacing="7" >
								<tr>
										<td><?php echo $tr->translate('EXPENSE_TITLE');?></td>
										<td>
											<input dojoType="dijit.form.ValidationTextBox" required="1" class="fullside" id="cate_name" name="cate_name" value="" type="text">
										</td>
									</tr>
									<tr>
										<td><?php echo $tr->translate('STATUS');?></td>
										<td>
											<select name="status_j" id="status_j" dojoType="dijit.form.FilteringSelect"   class="fullside">
			    								<option value="1" label="active"><?php echo $tr->translate("ACTIVE");?></option>
			    								<option value="0" label="deactive"><?php echo $tr->translate("DEACTIVE");?></option>
											</select>
										</td>
										
									</tr>
									<tr>
										<td colspan="4" align="center">
											<input type="button" value="ចាកចេញ" label="<?php echo $tr->translate("CANCEL");?>" id="close" name="close" dojoType="dijit.form.Button" 
											​ ​​iconClass="dijitIconUndo" onclick="hideDialog1();"/>
											<input type="button" value="save" label="<?php echo $tr->translate("GO_SAVE");?>" id="save" name="save" dojoType="dijit.form.Button" 
											 iconClass="dijitEditorIcon dijitEditorIconSave" onclick="addCategory();"/>
										</td>
									</tr>
								
							</table>
					</fieldset>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<div class="dijitHidden" style="width: 22cm !important; height: 11cm ; padding: 0px; margin: 0px;">
	<div data-dojo-type="dijit.Dialog" style="width:22cm; font-family:Khmer OS Battambang;" align="center" data-dojo-props="title:'<?php echo $tr->translate("PAYMENT_RECEIPT");?>'" id="print_expense" >
		<div id="divPrint" style="width: 21cm !important; height: 13cm ; padding: 0px; margin: 0px;">
			<style>
				.fontbig{
					font-size: 15px;	
				}
				.fonttel{
					font-size: 18px;	
				}
				.pleft{
					width: 110px;	
				}
				.label{ font-weight: bold;font-size: 22px;}
				.value{ font:16px 'Khmer OS Battambang';border: 1px solid #000; height: 30px; width: 100%;margin-right:5px; display: block;
						line-height: 28px;
					    text-align: center;
						}
				.print tr td{
					padding:2px 2px; 
				}
			   .khmerbold{font:16px 'Khmer OS Battambang';}
			   .khmer{font:16px 'Khmer OS Battambang';}
			   .one{white-space:nowrap;}
			.noted{
					white-space: pre-wrap;     
					word-wrap: break-word;      
					word-break: break-all;
					white-space: pre;
					font:12px 'Khmer OS Battambang';
					border: 1px solid #000;
                   line-height:20px;font-weight: normal !important;
                }
			</style>	
			<table width="100%" style="margin-top:-10px; font-family:'Khmer OS Muol Light';white-space:nowrap;" >
				<tr>
					<td id="projectlogo" width="25%">
						<img style="height:80px;" src="<?php echo $this->baseUrl().'/images/bppt_logo.png'?>">
					</td>					
					<td width="50%" style="font:18px 'Khmer OS Muol Light';" valign="top" align="center"><u><span style=" font-family: Arial Black;font-family:'Khmer OS Muol Light';">បង្កាន់ដៃចំណាយ</span></u>
						<div style="line-height:25px;"><strong style="font-size: 18px;">PAYMENT VOUCHER</strong></div>
					</td>
					<td width="25%"></td>
				</tr>
			</table>
			<table width="100%" style="margin-top:-2px; font-family:'Times New Roman','Khmer OS Battambang'; white-space: nowrap;font-size:14px;" class="print" cellspacing="2px"  cellpadding="0">
				<tr style="white-space: nowrap;">
					<td class="one khmerbold">គម្រោង</td>
                    <td><strong><label id="lb_branch" class="value"></label></strong></td>
				    <td class="one khmerbold">&nbsp;&nbsp;&nbsp;វិក័យប័ត្រលេខ</td>
                    <td colspan="3"><strong><label id="lb_invoice" class="value"></label></strong></td>
				</tr>
				<tr style="white-space: nowrap;">
					<td class="one khmerbold">លេខដី/ផ្ទះ</td>
				    <td ><strong style="white-space: nowrap;"><label style="white-space: nowrap;" id="lb_cheque" class="value"></label></strong></td>
					<td class="one khmerbold">&nbsp;&nbsp;&nbsp;ថ្ងៃចំណាយ</td>
				    <td colspan="3"><strong><label id="lb_date" class="value"></label></strong></td>
				</tr>
				
				<tr>
					<td class="one khmerbold">ប្រភេទចំណាយ</td>
					<td ><strong><label id="lb_income_category" class="value"></label></strong></td>
					
					<td class="one khmerbold">&nbsp;&nbsp;&nbsp;ចំណាយសរុប</td>
					<td colspan="3">
						<strong><label id="lb_total_amount" class="value"></label></strong>
					</td>
				</tr>
				
				<tr style="white-space: nowrap;">
					<td class="one khmerbold">ពណ៌នាចំនាយ</td>
				    <td ><strong><label id="lb_income_title" class="value"></label></strong></td>
				    
				 	<td class="one khmerbold">&nbsp;&nbsp;&nbsp;បង់ជា</td>
					<td><strong><label id="lbl_paymenttype" class="value"></label></strong></td>
					<td class="one khmerbold">&nbsp;&nbsp;លេខ</td>
					<td><strong><label id="lbl_cheque" class="value"></label></strong></td>
				 </tr>
				<tr>
					 <td rowspan="2" valign="top" class="one khmerbold">សម្គាល់</td>
				     <td rowspan="2"  valign="top"  class="noted"><strong style="white-space: nowrap;"><label style="white-space: nowrap;white-space: pre-line; " id="lb_description"></label></strong>
				</td>					
				</tr>
				<tr >
					<td>&nbsp;</td>
				</tr>
				<tr >
					<td>&nbsp;</td>
				</tr>
				<tr>
				 	<td class="khmerbold" style="line-height: 14px;"colspan="4"  align="center" >&nbsp;&nbsp;<span style=" font-family: Arial Black;font-family:'Khmer OS Muol Light';"><?php echo $this->data['teller_sign'];?></span></td>
				    <td colspan="2" class="khmerbold" style="line-height: 14px;" align="center" ><span style=" font-family: Arial Black;font-family:'Khmer OS Muol Light';"><?php echo $this->data['customer_sign'];?></span></td>
				</tr>
				<tr style="white-space: nowrap;" height="105px;">
					<td class="one khmerbold" colspan="4" align="center" valign="bottom">
						<h4 id="agent-sign" style="font-weight:normal; padding-right: 5px !important;margin-bottom: -3px  !important;"></h4>
					</td>
				    <td class="one khmerbold" colspan="2" align="center" valign="bottom">&nbsp;
			  			<h4 style="font-weight:normal; padding-right: 5px ! important;margin-bottom: -3px  !important;">
			              <?php $session_user=new Zend_Session_Namespace(SYSTEM_SES);
				           $last_name=$session_user->last_name;
				           $username = $session_user->first_name;
				           echo $last_name." ".$username;
					      ?>
					     </h4>  
					</td>
				</tr>
				<tr style="line-height: 15px;font-size: 10px;">
					<td colspan="6" style="border-top: 2px solid rgba(255, 235, 59, 0.88)"></td>
				</tr>
				<tr style="line-height: 15px;">
					<td colspan="6" ><?php echo $this->footer;?></td>
				</tr>
			</table>
		</div>
		<table>
			<tr>
				<td>				
					<iframe name=print_frame width=0 height=0 frameborder=0 src=about:blank></iframe>
					<button dojoType="dijit.form.Button" iconClass="dijitEditorIcon dijitEditorIconPrint"
					type="button" onclick="doPrint();">បោះពុម្ភ/Print</button>
				</td>
			</tr>
		</table>
		<div id="divPrint1" style="width: 21cm !important; height: 12cm ; padding: 0px; margin: 0px;">
			<?php if($this->data['showreceipt']>1){?>
				<div style="border:2px dashed #000; vertical-align: middle;margin:20px 0px 40px 0px"></div>
			<?php }?>
			<div id="printblog2"></div>
		</div>
	</div>
</div>
<div class="dijitHidden">
	<div data-dojo-type="dijit.Dialog" style="width:30%;" id="popup_staff" >
		<form style="background-color: buttonface; width:100%;" id='frm_staff' dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
			<table cellspacing="10" width="100%" style="margin: 0 auto;">
				<tr>
					<td>
						<fieldset style="background-color: buttonface;">
						<legend align="center" ><?php echo $tr->translate('ADD_STAFF');?></legend>
							<table style="margin: 0 auto; width: 100%;  padding:10px;" cellspacing="7" >
								<tr>
									<td><?php echo $tr->translate('NAME_KH');?></td>
									<td>
										<input dojoType="dijit.form.ValidationTextBox" required="true"  class="fullside" id="kh_name" name="kh_name" value="" type="text">
									</td>
								</tr>
								<tr>
									<td><?php echo $tr->translate('SEX');?></td>
									<td>
										<select dojoType="dijit.form.FilteringSelect"  class="fullside" id="sex" name="sex" value="" type="text">
											<option value="1">Male</option>
											<option value="2">Female</option>
										</select>
									</td>
								</tr>
								<input type="hidden" name="branch_id_pop" id="branch_id_pop" dojoType="dijit.form.TextBox" />
								<tr>
									<td><?php echo $tr->translate('PHONE');?></td>
									<td>
										<input type="text" name="phone" id="phone" class="fullside" dojoType="dijit.form.TextBox" />
									</td>
								</tr>
								<tr>
									<td><?php echo $tr->translate('NOTE');?></td>
									<td>
										<input type="text" name="note_pop" id="note_pop" class="fullside" dojoType="dijit.form.TextBox" />
									</td>
								</tr>
								<tr>
									<td colspan="4" align="center">
										<input type="button" value="save" label="SAVE" name="save" dojoType="dijit.form.Button" 
										 iconClass="dijitEditorIcon dijitEditorIconSave" onclick="addStaff();"/>
									</td>
								</tr>
							</table>
					</fieldset>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<div class="dijitHidden">
	<div data-dojo-type="dijit.Dialog" data-dojo-props="title:'<?php echo $tr->translate("CHEQUE_ISSUER")?>'"  id="frm_cheque" >
		<form id="form_cheque"​ dojoType="dijit.form.Form" >
			<table style="margin: 0 auto; width: 100%;" cellspacing="7">
				<tr>
					<td>
						<input dojoType="dijit.form.ValidationTextBox" required="true" class="fullside" id="addchequename" name="addchequename" value="" type="text">
					</td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<input type="button" id="save_cheque" value="Save" label="<?php echo $tr->translate('GO_SAVE');?>" dojoType="dijit.form.Button"
							iconClass="dijitEditorIcon dijitEditorIconSave" onclick="addNewCheque();"/>
					</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<script type="text/javascript">
var staff_store  = getDataStorefromJSON('id','name',<?php print_r(Zend_Json::encode($this->co_name));?> );
new dijit.form.FilteringSelect({
	store: staff_store,
	autoComplete: false, 
	queryExpr: "*${0}*",                              
    id: "staff_id",
    name: "staff_id",  
    value:'<?php echo $rs['staff_id'];?>',  
    class: 'fullside',  
    required:true,
    placeHolder:"<?php echo $tr->translate("SELECT_SALE_AGENT");?>", 
    onChange: function() {        
    	branch_id = dijit.byId('branch_id').get('value');
    	staff_id = dijit.byId('staff_id').get('value');
    	if(branch_id==0){
    		if(staff_id==-1){
    			alert('<?php echo $tr->translate("Please select project");?>');
    			dijit.byId('branch_id').focus();
    			return false;
        	}
    	}else{
		    if(staff_id==-1){
		    	dijit.byId('branch_id_pop').attr('value',branch_id);
		   		dijit.byId("popup_staff").show();
		    }
    	}
    } 
}, "staff_id");
function popupIssuer(){
	cheque_issuer = dijit.byId('cheque_issuer').get('value');
	if(cheque_issuer==-1){
		dijit.byId('save_cheque').set('disabled',false);
		dijit.byId('frm_cheque').show();
	}
}
require(["dojo/ready"], function(ready){
	new dijit.form.FilteringSelect({
		name: "cheque_issuer",
		id: "cheque_issuer",
		autoComplete: false,
		required: false,
		queryExpr: "*${0}*",     
		searchAttr: "name",
		class: 'fullside',
		onChange: function() {
			popupIssuer();
	    }
	}, "cheque_issuer");

	ready(function(){
		enablePayment();
	});
});
var chequeStore  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode($this->cheque_issue));?> );
function addNewCheque(){
	if(dijit.byId('form_cheque').validate()){
		var Itemmake = {					
				id: dijit.byId('addchequename').get('value'),
			    name: dijit.byId('addchequename').get('value')
		};		

		addDataToSelectbox(dijit.byId('cheque_issuer'),chequeStore , Itemmake, dijit.byId('addchequename').get('value'));
		
		//addDataToSelectbox(dijit.byId('cheque_issuer'), StreetStore, Itemmake, dijit.byId('addchequename').get('value'));	
		//dijit.byId('cheque_issuer').attr('value',dijit.byId('addchequename').get('value'));
		dijit.byId('form_cheque').reset();
		dijit.byId('frm_cheque').hide();
		dijit.byId('save_cheque').set('disabled',true);
	}
}
var first =1;
function enablePayment(){
	payment_method = dijit.byId('payment_type').get('value');
	dijit.byId("cheque").set("readOnly",false);
	if(first==0){
		dijit.byId("cheque").attr("value",'');
		first = 0;
	}
	dijit.byId("cheque_issuer").set("readOnly",false);
	if(payment_method==1){
		dijit.byId("cheque").attr("value",'N/A');
		dijit.byId("cheque").set("readOnly",true);
		dijit.byId('cheque_issuer').reset();
		dijit.byId("cheque_issuer").set("readOnly",true);
	}
}
function printSubmit(){
	 $('#frm_add_tran').submit();
}
function hideDialog1(){
	dijit.byId('popup_category').hide();
}
var url_add_staff = '<?php echo $this->url(array("module"=>"loan","controller"=>"index","action"=>"add-staff")); ?>';
function addStaff(){
	if(dijit.byId('frm_staff').validate()){
		dijit.byId('save_staff').set('disabled',true);
		dojo.xhrPost({
			url:url_add_staff,
			form: dojo.byId("frm_staff"),
			handleAs:"json",
			load: function(data) {
				var Itemmake = { 
		    	  	id: data,
			        name: dijit.byId('kh_name').get('value')
			    };
		 		addDataToSelectbox(dijit.byId('staff_id'), staff_store, Itemmake, data);
			    dijit.byId('frm_staff').reset();
			    dijit.byId("popup_staff").hide();
			    dijit.byId('save_staff').set('disabled',false);
			},
			error: function(err) {
			}
		});
	}
}

var income_category_store  = getDataStorefromJSON('id','name',<?php print_r(Zend_Json::encode($this->all_category));?> );
new dijit.form.FilteringSelect({
	store: income_category_store,
	autoComplete: false,  
	queryExpr: "*${0}*",                        
    id: "income_category",
    name: "income_category",  
    class: 'fullside',  
    required:false,
    placeHolder:"<?php echo $tr->translate("SELECT_CATEGORY");?>", 
    onChange: function(){          
	   	fa_job = dijit.byId('income_category').get('value');
	    if(fa_job==-1){
	   	 dijit.byId("popup_category").show();
	    }
    } 
}, "income_category");
dijit.byId("income_category").attr("value",<?php echo $this->category_id; ?>);

var url_add_category = '<?php echo $this->url(array("module"=>"incexp","controller"=>"expense","action"=>"add-category")); ?>';
function addCategory(){
	if(dijit.byId('frm_category').validate()){
		dijit.byId('save').set('disabled',true);
		dojo.xhrPost({
			url:url_add_category,
			form: dojo.byId("frm_category"),
			handleAs:"json",
			load: function(data) {
				var Itemmake = { 
		    		id: data,
			        name: dijit.byId('cate_name').get('value')
			    };
		 		addDataToSelectbox(dijit.byId('income_category'), income_category_store, Itemmake, data);
			    dijit.byId('frm_category').reset();
			    dijit.byId("popup_category").hide();
			    dijit.byId('save').set('disabled',false);
			},
			error: function(err) {
			}
		});
	}
}
var sale_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
var sale_client_store  = getDataStorefromJSON('id','name', <?php print_r(Zend_Json::encode(array()));?> );
dojo.ready(function(){
	try{
		new dijit.form.FilteringSelect({
		store: sale_store,
		autoComplete: true,
		required: false,		           
		name: "sale_no",
		id: "sale_no",
		searchAttr: "name",
		class: 'fullside',
			onChange: function() {
				getLandAndClientDetail("1");
			}
		}, "sale_no");

		new dijit.form.FilteringSelect({
			store: sale_client_store,
			autoComplete: true,
			required: false,		           
			name: "sale_client",
			id: "sale_client",
			searchAttr: "name",
			class: 'fullside',
				onChange: function() {
					getLandAndClientDetail("2");
				}
			}, "sale_client");
		getSaleClie();
		getSaleNo();
		getBranchinfo();
		
		}catch(e){
			
		}
		
});
var	url_getSaleNo = '<?php echo $this->url(array('module'=>'loan','controller'=>'cancel','action'=>'get-sale'));?>';
	function getSaleNo(){
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id==0){
			return false;}
		dojo.xhrPost({
			url:url_getSaleNo,	
			content:{ 
				'branch_id': branch_id
			},
			handleAs:"json",
			load: function(data) {	
				sale_store  = getDataStorefromJSON('id','name', data);		
			    dijit.byId('sale_no').set('store', sale_store);
			    dijit.byId("sale_no").attr("value",'<?php echo $rs['sale_id'];?>');
			    getBranchinfo();
			},
			error: function(err) {
				alert(err);
			}
		});
	}
	var	url_getSaleClien = '<?php echo $this->url(array('module'=>'loan','controller'=>'cancel','action'=>'get-saleclie'));?>';
	function getSaleClie(){
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id==0){
			return false;}
		dojo.xhrPost({
			url:url_getSaleClien,	
			content:{ 
				'branch_id': branch_id, 'sale_id':'',
			},
			handleAs:"json",
			load: function(data) {	
				sale_client_store  = getDataStorefromJSON('id','name', data);		
			    dijit.byId('sale_client').set('store', sale_client_store);
			    getBranchinfo();
			},
			error: function(err) {
				alert(err);
			}
		});
	}
	var url_land= '<?php echo $this->url(array('module'=>'loan','controller'=>'cancel','action'=>'get-info'));?>';
	function getLandAndClientDetail(inds){
		if(inds == "2"){
			sale_id = dijit.byId('sale_client').get('value');
			//dijit.byId('sale_no').attr("value",sale_id)
			dijit.byId("sale_no").set("value",sale_id);
		}else{
			sale_id = dijit.byId('sale_no').get('value');
			dijit.byId('sale_client').set("value",sale_id);
		}
		dojo.xhrPost({
			url:url_land,	
			content:{ 
			    'sale_id':sale_id
			},		    
			handleAs:"json",
			load: function(data) {
				dijit.byId('price_sold').attr('value',data.price_sold);
				dijit.byId('installment_paid').attr('value',data.installment_paid);
				
				total_principal= data.total_principal;
				if(isNaN(total_principal) || total_principal==null){total_principal=0;}
			    paid_amount = data.paid_amount;
				if(isNaN(paid_amount) || paid_amount==null){paid_amount=0;}
				total_principal = parseFloat(total_principal);
				dijit.byId('paid_amount').attr('value',total_principal);
				balance = data.price_sold-total_principal;
				dijit.byId('balance').attr('value',balance);
				//dijit.byId('period').attr('value',data.total_duration);
				//dijit.byId('buy_date').attr('value',data.buy_date);
				//dijit.byId('end_date').attr('value',data.end_line);
				dijit.byId('discount').attr('value',data.discount_amount);
				dijit.byId('schedule_opt').attr('value',data.payment_id);
				dojo.byId("property_id").value = data.property_id;
				//dijit.byId('sold_date').attr('value',data.create_date);
				dijit.byId('full_commission').attr('value',data.full_commission);

				if (data.comission_paid == null){
					data.comission_paid=0;
				}
				total_paid = parseFloat(data.comission)+parseFloat(data.comission_paid);
				var thisoldpaid = '<?php echo $this->row['total_amount'];?>';
				total_paid = total_paid -  parseFloat(thisoldpaid);
				dijit.byId('commision').attr('value',total_paid);

				commisionBalance = parseFloat(data.full_commission) - total_paid
				dijit.byId('commision_balance').attr('value',commisionBalance);
			},
			error: function(err) {
			}
		});
	}
	function checkreturnAmount(){
		fullcommission = dijit.byId('full_commission').get('value');
		commission = dijit.byId('commision').get('value');
		paid_amount = fullcommission - commission;
		return_back = dijit.byId('return_back').get('value');
		sale_id = dijit.byId('sale_client').get('value');
		if(sale_id==''){
			alert('សូមេជ្រើសរើសអតិថិជនជាមុនសិន!');
			dijit.byId('sale_client').focus();
			dijit.byId('return_back').attr('value',0);
			return false;
		}
		if(return_back>paid_amount){
			alert('ប្រាក់ដែលប្រគល់ត្រឡប់់មិនអាចធំជាងប្រាក់ដែលបានបង់នោះទេ!');
			dijit.byId('return_back').attr('value',paid_amount);
		}
	}
	function printSave(new_invoice_no){
		if(dijit.byId('add_cancel').validate()){
			branch_id = dijit.byId('branch_id').get('value');
		if(branch_id==0){
			alert('Select branch');
			dijit.byId('branch_id').focus();
			return false;
		}
		total_amount = dijit.byId('return_back').get('value');
		if(isNaN(total_amount)){
			alert('Income can not be null');
			dijit.byId('return_back').focus();
			return false;
		}		

		var invoice_no = dijit.byId("invoice_no").attr('displayedValue');
		dojo.byId("lb_invoice").innerHTML = invoice_no;
		dojo.byId("lb_branch").innerHTML = dijit.byId("branch_id").attr('displayedValue');
		dojo.byId("lb_income_category").innerHTML = dijit.byId("income_category").attr('displayedValue');
		dojo.byId("lb_income_title").innerHTML ='ចំណាយលើកម្រៃជើងសារ';
		dojo.byId("lb_total_amount").innerHTML = currencyFormat(dijit.byId("return_back").get('value'));

		dojo.byId("lbl_cheque").innerHTML = dijit.byId("cheque").attr('displayedValue');
		dojo.byId("lbl_paymenttype").innerHTML = dijit.byId("payment_type").attr('displayedValue');
		
		date_payment = '<?php echo date("Y-m-d");?>';
		var a = new Date(date_payment);
		mm = a.getMonth()+1;
		var dd = a.getDate();
		if(dd<10){
		dd = "0"+dd;
		}
		month = returnMOnth(mm);
		var y = a.getFullYear();
		var date_payment = dd +'-'+month+'-'+y ;
		
		dojo.byId("lb_date").innerHTML = date_payment;
		dojo.byId("lb_description").innerHTML = $("#note").val();
		dojo.byId("lb_cheque").innerHTML = dijit.byId("sale_client").attr('displayedValue');
		dojo.byId("lb_income_category").innerHTML =dijit.byId("income_category").attr('displayedValue');
		dojo.byId("agent-sign").innerHTML = dijit.byId("staff_id").attr('displayedValue');
		
		dijit.byId("print_expense").show();
		}
	}
	function currencyFormat(num) {
	    return "$ " + num.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,")
	}
	function displayNone(){
		document.getElementById('divPrint1').style.display="none";
	}
	var url_get_invoice = '<?php echo $this->url(array('module'=>'incexp','controller'=>'expense','action'=>'get-invoice-no')); ?>';
	function getInvoiceNo(condition){
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id==0){
			branch_id=1;
		}
		dojo.xhrPost({
			url:url_get_invoice,
			content:{
				'branch_id':branch_id
				},
			handleAs:"json",
			load: function(data) {
				if(condition==1){
					printSave(data);
				}
			},
			error: function(err) {
				alert(err);
			}
		});
	}
	function returnMOnth(monthnum){
		var month = new Array();
		month[1] = "01";
		month[2] = "02";
		month[3] = "03";
		month[4] = "04";
		month[5] = "05";
		month[6] = "06";
		month[7] = "07";
		month[8] = "08";
		month[8] = "09";
		month[10] = "10";
		month[11] = "11";
		month[12] = "12";
		return month[monthnum];
	}
	function doPrint() {
		dojo.byId("printblog2").innerHTML = dojo.byId('divPrint').innerHTML;
		window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint').innerHTML <?php if($this->data['showreceipt']>1){ ?>+ dojo.byId('divPrint1').innerHTML<?php }?>;
	    window.frames["print_frame"].window.focus();
	    window.frames["print_frame"].window.print();
	    printSubmit();
	    hideDialog();
	}
	function printSubmit(){
		 $('#add_cancel').submit();
	}
	function getBranchinfo(){
		var url_submit = '<?php echo $this->url(array('module'=>'loan','controller'=>'ilpayment','action'=>'getbranch')); ?>';
		branch_id = dijit.byId('branch_id').get('value');
		if(branch_id==""){
			return false;
		}
		dojo.xhrPost({
		    url: url_submit,	
		    content:{ 
			    'branch_id':branch_id
			},	
			load: function(data) {
				var arr = JSON.parse(data);
				var imagesUrl = '<img class="view" style="height:80px; max-width: 100%;" src="<?php echo $this->baseUrl()."/images/projects/"?>'+arr.logo+'" />';
				document.getElementById('projectlogo').innerHTML = imagesUrl;
			},
			error: function(e) {
			}
		});
	}
</script>