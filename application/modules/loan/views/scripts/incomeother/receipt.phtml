<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	$this->headTitle($tr->translate('REPORT_HOME')); 
	echo $this->headTitle(''); 
	$format = new Application_Model_DbTable_DbGlobal();
	
	$images = $this->baseUrl().'/images/logo.png';
	if (!empty($this->rs['photo'])){
		$images = $this->baseUrl().'/images/projects/'.$this->rs['photo'];
	}
?>	
<script src="<?php echo $this->baseUrl();?>/js/help.js"  type="text/javascript"></script>
<script type="dojo/method" event="onSubmit">			
	if(this.validate()) {
				return true;
			} else {
				return false;
			}
</script>
<style>
tr.head td h2 {
    font-size: 16px !important;
    line-height: 27px !important;
}
.b{ font-weight: bold; }

p.padding-left {
    line-height: 24px !important;
}

table#exportExcel tr td {
    font-size: 14px !important;
}
label.title {
    font-size: 14px !important;
    min-width: 100px !important;
}
label.value {
    font-size: 14px !important;
    min-width: 100px !important;
}
</style>
<script type="text/javascript">
dojo.require("dijit.form.NumberTextBox");
dojo.ready(function(){
	 
}); 
 
</script>
<table width="100%">
<div class="ptss-frame  js-ptss-frame "><!-- is-opened -->
		<div class="ptss__toggle-btn  js-ptss-toggle-btn ">
			<i class="fa fa-print"></i>
		</div>
      <div class="ptss__header"><?php echo $tr->translate("PRINT");?></div>
		<div class="ptss__settings">
			<div class="ptss__single-setting" id="ptss__layout">
				<div class="ptss__setting-control">
					<div class="ptss__layout-wrapper">
						<a class="qButton" title="<?php echo $tr->translate("Preview");?>" href="#" onclick="preview();"><i class="fa fa-search" aria-hidden="true"></i></a>
						<a class="qButton print" href="#" title="<?php echo $tr->translate("PRINT");?>" onclick="doPrint();" ><i class="fa fa-print" aria-hidden="true"></i></a>
						<a class="qButton excel" href="#"  title="<?php echo $tr->translate("Export");?>"  onclick="exportExcel();"><i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
					</div>
					
				</div>
			</div>
		</div>
</div>
</table>
<div style="background: #fff;width: 20cm;margin: 0 auto;min-height: 27cm; padding: 0.5cm;">
			<div id="divPrint">
				<style>
		   			label.value{
		   				font-weight: initial;
		   				min-width: 90px;
		   				font-size: 14px;
		   				display: inline-block;
					}
					p.padding-left {
					    padding-left: 10px;
						    line-height: 20px;
					}
					label.title {
					    font-size: 14px;
					    min-width: 80px;
					    display: inline-block;
					}
					.border {
					    
					    display: block;
					    width: 100%;
					    height: 1px;
					    margin-bottom: 10px;
					}
					#print-footer {
						position: absolute;
						bottom:0;
					}
		  		 </style>
				<table width="100%" style="white-space: nowrap;font-size:16px;margin-top: 0px;" class="print" cellspacing="0"  cellpadding="0" >
						<td colspan="6">
							<table width="100%" style="font-family:'Khmer MEF2';white-space:nowrap;">
								<tr>
									<td id="projectlogo" width="25%">
										<img style="height:75px;"  src="<?php echo $images;?>" alt="">
									</td>	
									<td width="50%" style="font:bold 18px 'Kh Muol';" valign="top" align="center">
										<div style="line-height:20px; margin-top:6%;"><u><strong style="font-weight: initial; font-family:'Khmer OS Muol Light'; font-size:17px;">របាយការណ៍ទូទាត់ថ្លៃចំណាយកែផ្ទះ</strong></u></div>
									</td>					
									<td width="25%">
									</td>
								</tr>
							</table>
						</td>
					<tr style="line-height: 35px; font-family: Khmer OS Battambang;">
							<td valign="top"> &nbsp;  </td>
						</tr>
				</table>
				<table width="100%" style="font-family:'Khmer OS Battambang';" style="margin:0; padding:23px; border:none;" >
						<tr style="line-height: 15px; font-size: 15px; font-family: Khmer OS Battambang;">
							<td colspan="3">ឈ្មោះអតិថិជន&nbsp;: <strong style="font-size:15px; line-height: 14px; font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo $this->rs['client_name'];?></strong></td>
							<td colspan="3">ប្រភេទបង់  &nbsp;: <strong style="font-size:15px; line-height: 14px; font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo $this->rs['payment_method'];?></strong></td>
							<td colspan="2">លេខបង្កាន់ដៃ &nbsp;: <strong style="font-size:15px; line-height: 14px; font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo $this->rs['invoice'];?></strong></td>
						</tr>
						<tr style="line-height: 15px; font-size: 15px; font-family: Khmer OS Battambang;">
							<td colspan="3">លេខផ្ទះ&nbsp;: <strong style="font-size:16px; line-height: 14px; font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo $this->rs['land_address'];?></strong></td>
							<td colspan="3">លេខផ្លូវ &nbsp;: <strong style="font-size:15px; line-height: 14px; font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo $this->rs['street'];?></strong></td>
							<td colspan="2">កាលបរិច្ឆេទ &nbsp;: <strong style="font-size:15px; line-height: 14px; white-space: nowrap;font-weight: bold; font-family:'Khmer OS Battambang';"><?php echo date('d/ m / Y',strtotime($this->rs['date']));?></strong></td>
						</tr>
						<tr style="line-height: 5px; font-family: Khmer OS Battambang;">
							<td valign="top"> &nbsp; </td>
						</tr>
		            	<tr>
			            	<td colspan="8" id="exportExcel">
			            		<table border="1" width="100%" style="border-collapse:collapse;border:1px solid #000; line-height: 24px; font-size: 14px; " > 
				            		<thead>
							    	<tr bgcolor="#c1d0f3" lign="center" style="white-space:nowrap;font-weight:bold; line-height: 14px; line-height: 24px; font-size:14px; padding:5px 0px; " >
										<th style="text-align:center;"><?php echo $tr->translate("NUM");?></th>
									    <th style="text-align:center; width: 38%;"><?php echo $tr->translate("DESCRIPTION");?></th>
									    <th style="text-align:center;"><?php echo $tr->translate("QUANTITY");?></th>
									    <th style="text-align:center;"><?php echo $tr->translate("COST");?></th>
									    <th style="text-align:center;"><?php echo $tr->translate("TOTAL_AMOUNT");?></th>
									</tr>
									</thead>
							       <?php  $branch_id='';$n=0; $i=0; $total=0; if(!empty($this->income)){foreach($this->income as $key =>$row) {$i++?>
									<tr style="font-size: 12px;line-height:28px;" align="left">
									   <td align="center" width="5%"><?php echo $i; ?></td>
									   <td align="left">&nbsp;<?php echo $row['description'];?></td>
									   <td align="left">&nbsp;<?php echo number_format($row['qty'],2);?></td>
									   <td align="left">&nbsp;<?php echo number_format($row['price'],2);?></td>
									   <td align="left">&nbsp;<?php echo  number_format($row['total'],2);?></td>
									</tr>
									<?php $total = $total +$row['total'];?>
									<?php }}?>
									<?php for($j=$i; $j<=7; $j++){?>
									<tr style="font-size: 12px;line-height:28px;" align="left">
									   <td align="center" width="5%"><?php echo $j+1; ?></td>
									   <td align="center" width="5%"></td>
									   <td align="center" width="5%"></td>
									   <td align="center" width="5%"></td>
									   <td align="center" width="5%"></td>
									</tr>
									<?php }?>
							    </table>
			            	</td>
		           		</tr>
		           		<tr>
							<td colspan="2"  align="center">
								<div style="margin-top:-5px;"></div>
							</td>
							<td colspan="2">
								&nbsp;
							</td>
							<td>
								<div style="margin-top:-15px;"></div>
							</td>
							<td>
							</td>
						</tr>
						<tr>
							<td colspan="5"></td>
							<td>
								<div style="margin-top:-20px; white-space: nowrap;​">សរុបទឹកប្រាក់ដែលត្រូវបង់</div>
							</td>
							<td>
								<div style="width:100%;border-bottom:1px solid #000;margin-bottom:20px; font-weight: bold;font-size: 16px;">: &nbsp;$ <?php echo number_format($total,2);?></div>
							</td>
						</tr>
		           		<tr >
							<td colspan="2"  align="center" valign="top">
								<div style="font-weight:bold;color:#000; font-size: 14px;margin-top:-10px;"> 
									ម្ចាស់ផ្ទះ
								</div>
							</td>
							<td colspan="2" align="center" valign="top">
								<div style="font-weight:bold;color:#000; font-size: 14px;margin-top:-10px;"> 
									  អ្នកធ្វើរបាយការណ៍
								</div>
							</td>
							<td></td>
							<td></td>
							</tr>
							<tr>
								<td colspan="2" align="center" width="30%">
									<div style="width:70%;border-bottom:1px solid #000;margin-bottom:10px;margin-top: 60px;"></div>
									<div style="font-weight:bold;color:#000; font-size: 14px;margin-top:-9px;"> 
										<label><?php echo $this->rs['client_name'];?></label>
									</div>
									<div style="margin-top:-2px;">Date : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / </div>
								</td>
								<td colspan="2" align="center" >
									<div style="width:70%;border-bottom:1px solid #000;margin-bottom:10px;margin-top: 60px;"></div>
									<div style="font-weight:bold;color:#000; font-size: 14px;margin-top:-7px;"> 
										 <?php 
						              	   $session_user=new Zend_Session_Namespace('authinstall');
								           $last_name=$session_user->last_name;
								           $username = $session_user->first_name;
								           echo $last_name." ".$username;?>
									</div>
									<div style="margin-top:-5px;">Date : <?php echo date('d / m / Y ',strtotime(Zend_Date::now()));?></div>
								</td>
								<td colspan="2" align="center"></td>
							</tr>
		          </table>
	   		</div>
		 </div>
<script type="text/javascript">
function doPrint() {
	window.frames["print_frame"].document.body.innerHTML=dojo.byId('divPrint').innerHTML;
    window.frames["print_frame"].window.focus();
    window.frames["print_frame"].window.print();
    hideDialog();
}
function preview()
{ 
  var disp_setting="toolbar=no,status=no,resizable=no,location=no,directories=yes,menubar=no,"; 
      disp_setting+="scrollbars=no,width=1200, height=700, left=100, top=25"; 
  var content_vlue = document.getElementById("divPrint").innerHTML; 
  
  var docprint=window.open("","",disp_setting); 
   docprint.document.open(); 
   docprint.document.write('<html><head>'); 
   docprint.document.write('</head><div style=" font-size:16px !important; margin:0px; font-family:Verdana;"><style>table th {font-size:14px !important;} table td{font-size:12px !important;}</style><center>');          
   docprint.document.write(content_vlue);          
   docprint.document.write('</center></div></html>'); 
   docprint.document.close(); 
   docprint.focus(); 
}
function exportExcel(){
	$('#exportExcel').tableExport({type:'excel',escape:'false'});
}
</script>

