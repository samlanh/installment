<?php
	$tr = Application_Form_FrmLanguages::getCurrentlanguage();
	echo $this->headTitle($tr->translate('UPDATE_BRANCH​​_INFO')); 
?>
<script>
dojo.require("dijit.form.Textarea");
dojo.require("dijit.form.DateTextBox");
</script>
<?php  $frm = $this->frm_branch;?>
<form action="<?php echo $this->url(array('module'=>'group','controller'=>'project','action'=>'edit')); ?>" dojoType="dijit.form.Form" method="post" enctype="application/x-www-form-urlencoded">
	 <script type="dojo/method" event="onSubmit">			
			if(this.validate()) {
				return true;
			} else {
				return false;
			}
	</script>
	<table cellspacing="10" style="margin: 0 auto; width:100%">
		<tr>
			<td width="33%" valign="top">
				<fieldset>
					<legend align="center"><strong><?php echo $tr->translate("UPDATE_BRANCH​​_INFO");?></strong></legend>
					<table cellspacing="5" width="100%" >
						<tr>
							<td align="center" valign="top">
								<table width="100%" cellspacing="10">
									<tr>
										<td><?php echo $tr->translate("BRANCH_CODE")?></td>
										<td><?php echo $frm->getElement("branch_code");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("PROJECT_NAME")?></td>
										<td><?php echo $frm->getElement("branch_namekh");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("PREFIX_CODE");?></td>
									    <td><?php echo $frm->getElement("prefix_code");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("BRANCH_ADDRESS")?></td>
										<td><?php echo $frm->getElement("br_address");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("PHONE")?></td>
										<td><?php echo $frm->getElement("branch_tel");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("BRNACH_FAX")?></td>
										<td><?php echo $frm->getElement("fax");?></td>	
									</tr>
									<tr>		
										<td><?php echo $tr->translate("BRANCH_NOTE")?></td>
										<td><?php echo $frm->getElement("branch_note");?></td>
									</tr>
									<tr>
										<td><?php echo $tr->translate("BRANCH_STATUS")?></td>
										<td><?php echo $frm->getElement("branch_status");?></td>
									</tr>
								</table>
							</td>							
						</tr>
					</table>	
				</fieldset>
			</td>	
			<td width="33%" valign="top">
				<fieldset>
					<legend align="center"><strong><?php echo $tr->translate("SIGNATUR_NAME");?></strong></legend>
					<table cellspacing="5" width="100%" >
						<tr>
							<td><?php echo $tr->translate("SELLER_NAME")?></td>
							<td><?php echo $frm->getElement("project_manager_namekh");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("NATIONALITY")?></td>
							<td><?php echo $frm->getElement("project_manager_nationality");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("SEX")?></td>
							<td><?php echo $frm->getElement("p_manager_sex");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("DOB")?></td>
							<td><?php echo $frm->getElement("dob_manager");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("NATIONALITY_NO")?></td>
							<td><?php echo $frm->getElement("project_manager_nation_id");?></td>
						<tr>
						<tr>
							<td><?php echo $tr->translate("Issue Date")?></td>
							<td><?php echo $frm->getElement("date_iss_doc");?></td>
						<tr>
						<tr>
							<td><?php echo $tr->translate("CURRENT_ADDRESS")?></td>
							<td><?php echo $frm->getElement("current_address");?></td>
						</tr>
					</table>
				</fieldset>
			</td>
			<td width="33%" valign="top">
				<fieldset>
					<legend align="center"><strong><?php echo $tr->translate("SIGNATUR_NAME_WITH");?></strong></legend>
					<table cellspacing="5" width="100%" >
						<tr>
							<td><?php echo $tr->translate("SELLER_NAME_WITH")?></td>
							<td><?php echo $frm->getElement("sc_project_manager_nameen");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("NATIONALITY")?></td>
							<td><?php echo $frm->getElement("sc_project_manager_nationality");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("SEX")?></td>
							<td><?php echo $frm->getElement("csp_manager_sex");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("DOB")?></td>
							<td><?php echo $frm->getElement("dob_cs_manager");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("NATIONALITY_NO")?></td>
							<td><?php echo $frm->getElement("sc_project_manager_nation_id");?></td>
						</tr>
						<tr>
							<td><?php echo $tr->translate("Issue Date")?></td>
							<td><?php echo $frm->getElement("date_iss_doc_cs_manager");?></td>
						<tr>
						<tr>
							<td><?php echo $tr->translate("CURRENT_ADDRESS")?></td>
							<td><?php echo $frm->getElement("cs_manager_current_address");?></td>
						</tr>
					</table>
				</fieldset>
			</td>		
		</tr>
		<tr style="background: #fff;padding:2px;">
			<td colspan="3" align="center" style="   border: 1px solid #7296de;";>
			<div  id="showrecord"></div>
			<input type="button" label="<?php echo $tr->translate('បន្ថែមម្ចាស់ភាគហ៊ុន');?>" dojoType="dijit.form.Button" 
		 	iconClass="dijitIconEditProperty" onclick="addRow();" />
		 	<input type="hidden" name="identity" id="identity"  value="" >
		</tr>
		<tr>
			<td colspan="3" align="center">
				<input type="reset" value="សំអាត" label="<?php echo $tr->translate('CLEAR');?>" dojoType="dijit.form.Button" iconClass="dijitIconClear" />
				<input type="submit" value="save_new" name="save_new" label="<?php echo $tr->translate('GO_EDIT');?>" dojoType="dijit.form.Button" 
					iconClass="dijitEditorIcon dijitEditorIconSave" />
			</td>	
		</tr>
	</table>	
</form>
<script>
dojo.require("dojo.NodeList-manipulate");
dojo.require("dojo.html");
dojo.require("dijit.form.NumberTextBox");
require(["dojo/ready"], function(ready){
	 ready(function(){
		 	initailize();
	  });
});
	

function initailize(){
	no=0;title=0;temp='';i=0; $('#identity').val('');
	dojo.byId("showrecord").innerHTML = '';
	tmp='<table id="table_row" width="100%" style="border-collapse: collapse; border:1px solid #ccc !important;">';
	tmp+='<tr id="head-title" class="head-td" style="background:#eee; font-size: 12px; height: 30px;margin-bottom: 10px;" id="head_title" class="head-title" align="center"></tr>';
	tmp+='</table>';
	dojo.query("#showrecord").append(tmp);
	<?php if(!empty($this->rsshare)){
		foreach($this->rsshare as  $row){
	?>
			col++;no++;i++;
			template='';
			if(title!=1){    
				temp+='<th><?php echo $tr->translate("DEL");?></th>';
				temp+='<th><?php echo $tr->translate("NUM");?></th>';
				temp+='<th><?php echo $tr->translate("ឈ្មោះម្ចាស់ភាគហ៊ុន");?></th>';
				temp+='<th id="lbl_titlemetion" width="130px"><?php echo $tr->translate("ភេទ");?></th>';
				temp+='<th id="lbl_titlemetion" width="130px"><?php echo $tr->translate("ថ្ងៃខែឆ្នាំកំណើត");?></th>';
				temp+='<th><?php echo $tr->translate("លេខអត្តសញ្ញាណប័ណ្ណ");?></th>';
				temp+='<th><?php echo $tr->translate("អាសយដ្ឋាន");?></th>';
				temp+='<th><?php echo $tr->translate("លេខទូរស័ព្ទ");?></th>';
				temp+='<th><?php echo $tr->translate("ចំនួនភាគហ៊ុន");?></th>';
				dojo.query("#head-title").append(temp);
				title=1;
			}

			template+='<td width="47px"align="center"><img onclick="deleteRecord('+col+')" src="<?php echo $this->baseUrl();?>/images/Delete_16.png"></td>';
			template+='<td width="2%" align="center">'+no+'</td>';
			template+='<td><input class="fullside" type="text" required="true" data-dojo-type="dijit.form.ValidationTextBox" id="shareholdername'+col+'" name="shareholdername'+col+'" /></td>';	//data-dojo-props='+'regExp:"[0-9]{1,2}"'+'		
			template+='<td width="50px;"><select class="fullside" dojoType="dijit.form.FilteringSelect" id="gender'+col+'" name="gender'+col+'" > <option value="ប្រុស">ប្រុស</option><option  value="ស្រី">ស្រី</option></select></td>';			
			template+="<td><input class='fullside' type='text' constraints="+"{datePattern:'dd/MM/yyyy'}"+" dojoType='dijit.form.DateTextBox' value='' id='dob"+col+"' name='dob"+col+"' /></td>";
			template+='<td><input class="fullside" type="text"  name="id_card'+col+'" id="id_card'+col+'" dojoType="dijit.form.TextBox" placeholder="លេខអត្តសញ្ញាណប័ណ្ណ"/></td>';
			template+='<td  width="250px;"><input class="fullside" type="text"  name="pob'+col+'" id="pob'+col+'" dojoType="dijit.form.TextBox" /></td>';
			template+='<td><input class="fullside" type="text"  name="phonenumber'+col+'" id="phonenumber'+col+'" dojoType="dijit.form.TextBox" /></td>';
			template+='<td width="80px;"><input class="fullside" type="text" required="true" data-dojo-type="dijit.form.NumberTextBox" id="percent'+col+'" name="percent'+col+'" /></td>';
			
			tmp='<tr class="hover" style="border-bottom:1px solid #ccc;" id="row'+col+'">';
			tmp+="</tr>";
			dojo.query("#table_row").append(tmp);
		
			if($("#identity").val()!="") {
				var identity = $("#identity").val();
				$("#identity").val(identity+','+col);
			} else {$("#identity").val(col);}
			dojo.html.set(dojo.byId("row"+col),template , {
			     parseContent: true,
			});
		dijit.byId('shareholdername'+col).attr('value','<?php echo $row['shareholder_name']?>');
		dijit.byId('gender'+col).attr('value','<?php echo $row['gender'];?>');
		dijit.byId('dob'+col).attr('value','<?php echo $row['dob']?>');
		dijit.byId('pob'+col).attr('value','<?php echo $row['pob']?>');
	    dijit.byId('id_card'+col).attr('value','<?php echo $row['nation_id']?>');
	    dijit.byId('phonenumber'+col).attr('value','<?php echo $row['tel']?>');
	    dijit.byId('percent'+col).attr('value','<?php echo $row['percentage']?>');
		<?php } }?>
}
col=0;no=0;
title=0;
temp='';
function addRow(){
	temp='';
	col++;no++;
	template='';
	if(title!=1){    
		tmp='<table id="table_row" width="100%" style="border-collapse: collapse; border:1px solid #ccc !important;">';
		tmp+='<tr id="head-title" class="head-td" style="background:#eee; font-size: 12px; height: 30px;margin-bottom: 10px;" id="head_title" class="head-title" align="center"></tr>';
		tmp+='</table>';
		dojo.query("#showrecord").append(tmp);
		temp+='<th><?php echo $tr->translate("DEL");?></th>';
		temp+='<th><?php echo $tr->translate("NUM");?></th>';
		temp+='<th><?php echo $tr->translate("ឈ្មោះម្ចាស់ភាគហ៊ុន");?></th>';
		temp+='<th id="lbl_titlemetion" width="130px"><?php echo $tr->translate("ភេទ");?></th>';
		temp+='<th id="lbl_titlemetion" width="130px"><?php echo $tr->translate("ថ្ងៃខែឆ្នាំកំណើត");?></th>';
		temp+='<th><?php echo $tr->translate("លេខអត្តសញ្ញាណប័ណ្ណ");?></th>';
		temp+='<th><?php echo $tr->translate("អាសយដ្ឋាន");?></th>';
		temp+='<th><?php echo $tr->translate("លេខទូរស័ព្ទ");?></th>';
		temp+='<th><?php echo $tr->translate("ចំនួនភាគហ៊ុន");?></th>';
		dojo.query("#head-title").append(temp);
		title=1;
		epx_date ='<?php echo date('Y-m-d');?>';
	}else{
		epx_date ='<?php echo date('Y-m-d');?>';
	}
		template+='<td width="47px"align="center"><img onclick="deleteRecord('+col+')" src="<?php echo $this->baseUrl();?>/images/Delete_16.png"></td>';
		template+='<td width="2%" align="center">'+no+'</td>';
		template+='<td><input class="fullside" type="text" required="true" data-dojo-type="dijit.form.ValidationTextBox" id="shareholdername'+col+'" name="shareholdername'+col+'" /></td>';	
		template+='<td width="50px;"><select class="fullside" dojoType="dijit.form.FilteringSelect" id="gender'+col+'" name="gender'+col+'" > <option value="ប្រុស">ប្រុស</option><option  value="ស្រី">ស្រី</option></select></td>';			
		template+="<td><input class='fullside' type='text' constraints="+"{datePattern:'dd/MM/yyyy'}"+" dojoType='dijit.form.DateTextBox' value='"+epx_date+"' id='dob"+col+"' name='dob"+col+"' /></td>";
		template+='<td><input class="fullside" type="text"  name="id_card'+col+'" id="id_card'+col+'" dojoType="dijit.form.TextBox" placeholder="លេខអត្តសញ្ញាណប័ណ្ណ"/></td>';
		template+='<td  width="250px;"><input class="fullside" type="text"  name="pob'+col+'" id="pob'+col+'" dojoType="dijit.form.TextBox" /></td>';
		template+='<td><input class="fullside" type="text"  name="phonenumber'+col+'" id="phonenumber'+col+'" dojoType="dijit.form.TextBox" /></td>';
		template+='<td width="80px;"><input class="fullside" type="text" required="true" data-dojo-type="dijit.form.NumberTextBox" id="percent'+col+'" name="percent'+col+'" /></td>';
	tmp='<tr class="hover" style="border-bottom:1px solid #ccc;" id="row'+col+'">';
	tmp+="</tr>";
	dojo.query("#table_row").append(tmp);

	if($("#identity").val()!="") {
		var identity = $("#identity").val();
		$("#identity").val(identity+','+col);
	} else {$("#identity").val(col);}
	dojo.html.set(dojo.byId("row"+col),template , {
	     parseContent: true,
	});
}
function deleteRecord(index) {
	var identity = $('#identity').val();
	var arrays = identity.split(',');
	for(var i=0;i<arrays.length;i++) {
	if(arrays[i] == index) arrays.splice(i,1);
	}
	var strings = arrays.join(',');
	$('#identity').val(strings);
	dojo.query("#row"+index).remove();
}
</script>